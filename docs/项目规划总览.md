# WinsRehab 智慧康复应用 - 项目规划文档

## 📋 文档概述

本文档是 WinsRehab 智慧康复应用的完整项目规划，包含需求分析、功能设计、数据库设计、业务流程和开发计划。

**文档版本**：v1.0  
**创建日期**：2024年  
**项目类型**：Android 原生应用（Kotlin + MVVM）

---

## 🎯 项目定位

WinsRehab 是一个**医患协作的康复管理闭环系统**，旨在通过数字化手段提升康复训练的效率和效果。

### 核心价值
- **医生端**：高效管理患者，制定个性化康复计划，实时监控康复进度
- **患者端**：清晰的训练指导，及时的医生反馈，持续的心理支持
- **闭环管理**：诊断 → 计划 → 执行 → 反馈 → 调整 → 康复

### 目标用户
- **医生**：康复科医生、理疗师
- **患者**：需要康复训练的患者（脑卒中、骨折、运动损伤等）

---

## 🏗️ 系统架构

### 技术栈
- **开发语言**：Kotlin
- **架构模式**：MVVM (Model-View-ViewModel)
- **数据库**：Room Database
- **异步处理**：Kotlin Coroutines + Flow
- **网络请求**：OkHttp + Gson
- **导航**：Navigation Component
- **AI集成**：DeepSeek API（心理助手）

### 应用结构
```
WinsRehab
├── 医生端
│   ├── 医生工作台（主页）
│   ├── 患者管理
│   ├── 康复计划制定
│   ├── 视频审核
│   ├── 患者反馈处理
│   └── 医生信息管理
│
└── 患者端
    ├── 患者主页
    ├── 康复中心（训练执行）
    ├── 我的康复计划
    ├── 视频审核结果
    ├── 心理助手（AI聊天）
    ├── 病友社区
    ├── 示范视频库
    └── 患者信息管理
```

---

## 🔄 核心业务流程

### 完整康复闭环
```
1. 患者注册并绑定医生（输入医生工号）
   ↓
2. 医生确认接收患者
   ↓
3. 医生诊断并制定康复计划（包含多个训练任务）
   ↓
4. 系统生成每日训练任务
   ↓
5. 患者查看今日任务并执行训练
   ↓
6. 患者录制训练视频并上传（可附带文字说明）
   ↓
7. 医生审核视频并给出点评
   ↓
8. 患者查看审核结果和医生建议
   ↓
9. 患者可独立发送反馈给医生
   ↓
10. 医生根据反馈调整康复计划
    ↓
11. 循环执行直至康复目标达成
```

### 关键节点说明

#### 1. 医患绑定机制
- **患者主动绑定**：首次登录时输入医生工号
- **医生确认接收**：医生端收到"新患者申请"通知，确认后正式建立医患关系
- **验证机制**：医生工号必须在系统中存在才能绑定
- **绑定状态**：pending（待确认）→ active（已确认）→ inactive（已解除）

#### 2. 康复计划生命周期
- **草稿阶段**：医生创建计划，可以修改和完善
- **激活阶段**：医生确认计划，系统开始生成每日任务
- **执行阶段**：患者按计划完成训练任务
- **调整阶段**：医生根据反馈调整计划（覆盖旧计划，保留调整记录）
- **完成阶段**：达到康复目标，计划标记为已完成
- **多计划支持**：一个患者可以同时有多个活跃计划（如上肢康复计划 + 下肢康复计划）

#### 3. 视频审核流程
- **上传**：患者完成训练后录制视频并上传
- **队列**：视频进入医生的待审核队列
- **审核**：医生播放视频，查看患者说明，给出点评
- **状态**：pending（待审核）→ reviewing（审核中）→ approved（通过）/ needs_improvement（需改进）
- **通知**：审核完成后患者收到通知

---

## 📱 功能模块详细设计

详细功能设计请参考：
- [医生端功能设计](./医生端功能设计.md)
- [患者端功能设计](./患者端功能设计.md)
- [数据库设计方案](./数据库设计方案.md)
- [业务逻辑设计](./业务逻辑设计.md)
- [开发计划与优先级](./开发计划与优先级.md)

---

## 🎨 UI/UX 设计原则

### 设计风格
- **医生端**：专业、高效、数据驱动（蓝色主题）
- **患者端**：温暖、鼓励、易用（绿色主题）

### 交互原则
1. **简洁明了**：核心功能一目了然，减少学习成本
2. **及时反馈**：操作后立即给出反馈（Toast、通知）
3. **状态清晰**：任务状态、审核状态用颜色和图标区分
4. **鼓励机制**：进度可视化、完成后的鼓励语、排行榜

### 无障碍设计
- **大字体支持**：考虑老年患者，支持系统字体缩放
- **高对比度**：重要信息使用高对比度颜色
- **语音提示**：关键操作支持语音反馈（可选）

---

## 🔐 安全与隐私

### 数据安全
- **密码加密**：使用 SHA-256 加密存储
- **本地存储**：敏感数据使用 EncryptedSharedPreferences
- **API Key 保护**：DeepSeek API Key 存储在 local.properties

### 隐私保护
- **社区匿名**：患者可选择显示昵称或匿名
- **病情保密**：社区中不显示具体诊断信息
- **排行榜可选**：患者可选择退出排行榜
- **数据权限**：医生只能查看自己管理的患者数据

---

## 📊 数据统计与分析

### 医生端统计
- 管理患者总数
- 本月完成康复计划数
- 患者满意度评分
- 待处理事项数量（待审核视频、待回复反馈）

### 患者端统计
- 康复天数（从开始日期计算）
- 本周完成率（已完成任务 / 总任务）
- 总体康复进度（基于计划周期）
- 每日/每周训练时长
- 本周完成情况柱状图

---

## 🚀 技术实现要点

### 1. 任务生成机制
- **触发时机**：患者登录时动态生成今日任务
- **生成逻辑**：根据康复计划中的任务模板（TrainingTask）和频率规则生成任务实例（TaskInstance）
- **频率支持**：每天、每周特定天、间隔天数

### 2. 视频处理
- **录制**：使用 CameraX 或 MediaRecorder
- **压缩**：限制分辨率（720p）和时长（最长5分钟）
- **存储**：初期本地存储，后期扩展云存储
- **路径管理**：使用相对路径，便于后期迁移

### 3. 实时数据更新
- **使用 Flow**：数据库查询返回 Flow，UI 自动响应数据变化
- **LiveData/StateFlow**：ViewModel 中使用 StateFlow 管理 UI 状态
- **Fragment Result API**：Fragment 间通信使用官方 API

### 4. 通知系统
- **本地通知**：使用 NotificationManager
- **通知场景**：
  - 医生端：新视频待审核、新反馈待回复、新患者申请
  - 患者端：视频审核完成、医生回复反馈、新的训练任务

### 5. 性能优化
- **数据冗余**：在 Patient 表中冗余统计字段，避免频繁计算
- **索引优化**：为常用查询字段添加索引
- **分页加载**：患者列表、帖子列表使用 Paging3
- **图片缓存**：头像、缩略图使用 Glide 缓存

---

## 🧪 测试策略

### 单元测试
- Repository 层业务逻辑测试
- ViewModel 层数据处理测试
- 工具类函数测试

### 集成测试
- 数据库操作测试
- API 调用测试
- 完整业务流程测试

### UI 测试
- 关键页面交互测试
- 导航流程测试
- 异常情况处理测试

---

## 📅 版本规划

### v1.0（MVP 版本）
- 医患绑定
- 康复计划制定
- 训练任务执行
- 视频录制上传（本地存储）
- 视频审核
- 基础统计数据

### v1.1
- 患者独立反馈功能
- 医生回复反馈
- 康复计划调整
- 进度可视化优化

### v1.2
- 心理助手（AI 聊天）
- 示范视频库
- 医生每日任务
- 通知系统

### v1.3
- 病友社区
- 每周排行榜
- 社区互动功能

### v2.0
- 云存储支持
- 多端同步
- 数据导出
- 高级统计分析

---

## 📞 联系与支持

**项目名称**：WinsRehab  
**开发团队**：[您的团队名称]  
**技术支持**：[联系方式]

---

**文档结束**







