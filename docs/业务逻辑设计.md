# ä¸šåŠ¡é€»è¾‘è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° WinsRehab åº”ç”¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬å…³é”®æµç¨‹ã€ç®—æ³•è®¾è®¡å’Œæ•°æ®å¤„ç†è§„åˆ™ã€‚

---

## ğŸ”„ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### ä¸€ã€åŒ»æ‚£ç»‘å®šæµç¨‹

#### æµç¨‹æè¿°
æ‚£è€…é¦–æ¬¡ç™»å½•æ—¶è¾“å…¥åŒ»ç”Ÿå·¥å·ï¼ŒåŒ»ç”Ÿç¡®è®¤åå»ºç«‹åŒ»æ‚£å…³ç³»ã€‚

#### è¯¦ç»†æ­¥éª¤

**æ‚£è€…ç«¯æ“ä½œ**ï¼š
1. æ‚£è€…æ³¨å†Œè´¦å·ï¼ˆæ‰‹æœºå· + å¯†ç ï¼‰
2. é¦–æ¬¡ç™»å½•åï¼Œç³»ç»Ÿæ£€æµ‹åˆ°æœªç»‘å®šåŒ»ç”Ÿ
3. å¼¹å‡º"ç»‘å®šåŒ»ç”Ÿ"å¯¹è¯æ¡†
4. æ‚£è€…è¾“å…¥åŒ»ç”Ÿå·¥å·
5. ç³»ç»ŸéªŒè¯åŒ»ç”Ÿå·¥å·æ˜¯å¦å­˜åœ¨
   - ä¸å­˜åœ¨ï¼šæç¤º"åŒ»ç”Ÿå·¥å·ä¸å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥"
   - å­˜åœ¨ï¼šç»§ç»­ä¸‹ä¸€æ­¥
6. åˆ›å»ºæ‚£è€…è®°å½•ï¼Œè®¾ç½® `bindingStatus = "pending"`
7. ç”ŸæˆåŒ»ç”Ÿä»»åŠ¡ï¼šç±»å‹ä¸º"æ–°æ‚£è€…ç”³è¯·"
8. æç¤ºæ‚£è€…ï¼š"ç»‘å®šç”³è¯·å·²å‘é€ï¼Œç­‰å¾…åŒ»ç”Ÿç¡®è®¤"

**åŒ»ç”Ÿç«¯æ“ä½œ**ï¼š
1. åŒ»ç”Ÿæ”¶åˆ°é€šçŸ¥ï¼š"æ‚¨æœ‰æ–°çš„æ‚£è€…ç”³è¯·"
2. åŒ»ç”Ÿç‚¹å‡»é€šçŸ¥ï¼ŒæŸ¥çœ‹æ‚£è€…ç”³è¯·è¯¦æƒ…
   - æ‚£è€…å§“å
   - è´¦å·ï¼ˆæ‰‹æœºå·ï¼‰
   - ç”³è¯·æ—¶é—´
3. åŒ»ç”Ÿé€‰æ‹©æ“ä½œï¼š
   - **ç¡®è®¤æ¥æ”¶**ï¼š
     - æ›´æ–°æ‚£è€…çš„ `bindingStatus = "active"`
     - æ›´æ–°åŒ»ç”Ÿçš„ `patientCount += 1`
     - åˆ é™¤åŒ»ç”Ÿä»»åŠ¡
     - æ‚£è€…ç«¯æ”¶åˆ°é€šçŸ¥ï¼š"åŒ»ç”Ÿå·²ç¡®è®¤ï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨äº†"
   - **æ‹’ç»ç”³è¯·**ï¼š
     - æ›´æ–°æ‚£è€…çš„ `bindingStatus = "rejected"`
     - åˆ é™¤åŒ»ç”Ÿä»»åŠ¡
     - æ‚£è€…ç«¯æ”¶åˆ°é€šçŸ¥ï¼š"åŒ»ç”Ÿæ‹’ç»äº†æ‚¨çš„ç”³è¯·ï¼Œè¯·è”ç³»å…¶ä»–åŒ»ç”Ÿ"

#### çŠ¶æ€æµè½¬
```
pendingï¼ˆå¾…ç¡®è®¤ï¼‰â†’ activeï¼ˆå·²ç¡®è®¤ï¼‰
                 â†’ rejectedï¼ˆå·²æ‹’ç»ï¼‰
```

#### ç‰¹æ®Šæƒ…å†µå¤„ç†
- æ‚£è€…å¯ä»¥æ›´æ¢åŒ»ç”Ÿï¼šä¿®æ”¹ `doctorCode`ï¼Œé‡æ–°èµ°ç»‘å®šæµç¨‹
- åŒ»ç”Ÿå¯ä»¥è§£é™¤æ‚£è€…ï¼šå°† `bindingStatus` è®¾ä¸º "inactive"

---

### äºŒã€åº·å¤è®¡åˆ’åˆ¶å®šä¸æ‰§è¡Œæµç¨‹

#### æµç¨‹æè¿°
åŒ»ç”Ÿä¸ºæ‚£è€…åˆ¶å®šåº·å¤è®¡åˆ’ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆæ¯æ—¥ä»»åŠ¡ï¼Œæ‚£è€…æ‰§è¡Œä»»åŠ¡å¹¶ä¸Šä¼ è§†é¢‘ã€‚

#### è¯¦ç»†æ­¥éª¤

**é˜¶æ®µ1ï¼šåŒ»ç”Ÿåˆ¶å®šè®¡åˆ’**
1. åŒ»ç”Ÿåœ¨æ‚£è€…è¯¦æƒ…é¡µç‚¹å‡»"åˆ¶å®šæ–°è®¡åˆ’"
2. å¡«å†™è®¡åˆ’åŸºæœ¬ä¿¡æ¯ï¼š
   - è®¡åˆ’åç§°
   - åº·å¤ç›®æ ‡
   - å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸ
3. æ·»åŠ è®­ç»ƒä»»åŠ¡ï¼ˆä»»åŠ¡æ¨¡æ¿ï¼‰ï¼š
   - ä»»åŠ¡åç§°ã€ç±»å‹ã€æè¿°
   - å»ºè®®æ—¶é•¿
   - æ‰§è¡Œé¢‘ç‡ï¼ˆæ¯å¤©/æ¯å‘¨ç‰¹å®šå¤©/é—´éš”å¤©æ•°ï¼‰
   - ä¼˜å…ˆçº§
4. é¢„è§ˆè®¡åˆ’
5. é€‰æ‹©æ“ä½œï¼š
   - **ä¿å­˜ä¸ºè‰ç¨¿**ï¼š`status = "draft"`ï¼Œå¯ä»¥ç»§ç»­ç¼–è¾‘
   - **æ¿€æ´»è®¡åˆ’**ï¼š`status = "active"`ï¼Œç³»ç»Ÿå¼€å§‹ç”Ÿæˆä»»åŠ¡

**é˜¶æ®µ2ï¼šç³»ç»Ÿç”Ÿæˆä»»åŠ¡å®ä¾‹**
- è§¦å‘æ—¶æœºï¼šæ‚£è€…ç™»å½•æ—¶
- ç”Ÿæˆé€»è¾‘ï¼š
  1. æŸ¥è¯¢æ‚£è€…çš„æ‰€æœ‰æ´»è·ƒè®¡åˆ’ï¼ˆ`status = "active"`ï¼‰
  2. éå†æ¯ä¸ªè®¡åˆ’çš„ä»»åŠ¡æ¨¡æ¿
  3. æ ¹æ®ä»»åŠ¡çš„é¢‘ç‡è§„åˆ™ï¼Œåˆ¤æ–­ä»Šå¤©æ˜¯å¦éœ€è¦ç”Ÿæˆä»»åŠ¡å®ä¾‹
  4. å¦‚æœéœ€è¦ï¼Œåˆ›å»º TaskInstance è®°å½•
  5. æ›´æ–°æ‚£è€…çš„ `todayTasksTotal`

**é¢‘ç‡è§„åˆ™åˆ¤æ–­**ï¼š
- **æ¯å¤©æ‰§è¡Œï¼ˆdailyï¼‰**ï¼šæ¯å¤©éƒ½ç”Ÿæˆ
- **æ¯å‘¨ç‰¹å®šå¤©ï¼ˆweeklyï¼‰**ï¼š
  - `frequencyDetail` å­˜å‚¨æ˜ŸæœŸå‡ ï¼ˆå¦‚"1,3,5"è¡¨ç¤ºå‘¨ä¸€ã€å‘¨ä¸‰ã€å‘¨äº”ï¼‰
  - åˆ¤æ–­ä»Šå¤©æ˜¯å¦åœ¨æŒ‡å®šçš„æ˜ŸæœŸå‡ 
- **é—´éš”å¤©æ•°ï¼ˆintervalï¼‰**ï¼š
  - `frequencyDetail` å­˜å‚¨é—´éš”å¤©æ•°ï¼ˆå¦‚"2"è¡¨ç¤ºæ¯éš”2å¤©ï¼‰
  - è®¡ç®—ä¸Šæ¬¡æ‰§è¡Œæ—¥æœŸï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³é—´éš”

**é˜¶æ®µ3ï¼šæ‚£è€…æ‰§è¡Œä»»åŠ¡**
1. æ‚£è€…ç™»å½•ï¼Œçœ‹åˆ°ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨
2. ç‚¹å‡»"å¼€å§‹è®­ç»ƒ"ï¼Œé€‰æ‹©è¦å®Œæˆçš„ä»»åŠ¡
3. è¿›å…¥å½•åˆ¶ç•Œé¢ï¼Œå½•åˆ¶è®­ç»ƒè§†é¢‘
4. å½•åˆ¶å®Œæˆåï¼Œæ·»åŠ æ–‡å­—è¯´æ˜ï¼ˆå¯é€‰ï¼‰
5. ä¸Šä¼ è§†é¢‘ï¼š
   - åˆ›å»º TrainingVideo è®°å½•
   - å…³è” TaskInstance
   - è®¾ç½® `status = "pending"`
6. æ›´æ–° TaskInstance çš„ `status = "completed"`
7. æ›´æ–°æ‚£è€…çš„ `todayTasksCompleted += 1`
8. ç”ŸæˆåŒ»ç”Ÿä»»åŠ¡ï¼šç±»å‹ä¸º"å®¡æ ¸è§†é¢‘"

**é˜¶æ®µ4ï¼šåŒ»ç”Ÿå®¡æ ¸è§†é¢‘**
ï¼ˆè¯¦è§"è§†é¢‘å®¡æ ¸æµç¨‹"ï¼‰

#### è®¡åˆ’è°ƒæ•´
åŒ»ç”Ÿå¯ä»¥éšæ—¶è°ƒæ•´è®¡åˆ’ï¼š
1. åŒ»ç”Ÿåœ¨è®¡åˆ’è¯¦æƒ…é¡µç‚¹å‡»"è°ƒæ•´è®¡åˆ’"
2. é€‰æ‹©è°ƒæ•´ç±»å‹ï¼š
   - æ·»åŠ æ–°ä»»åŠ¡
   - ä¿®æ”¹ç°æœ‰ä»»åŠ¡ï¼ˆæ—¶é•¿ã€é¢‘ç‡ï¼‰
   - åˆ é™¤ä»»åŠ¡
   - ä¿®æ”¹è®¡åˆ’å‘¨æœŸ
3. å¡«å†™è°ƒæ•´åŸå› 
4. ä¿å­˜è°ƒæ•´ï¼š
   - åˆ›å»º PlanAdjustment è®°å½•
   - æ›´æ–° RehabPlan çš„ `updatedAt`
   - æ–°ä»»åŠ¡ä»è°ƒæ•´æ—¥æœŸå¼€å§‹ç”Ÿæ•ˆ
   - æ—§ä»»åŠ¡å®ä¾‹ä¿ç•™ï¼Œä¸å—å½±å“
5. æ‚£è€…ç«¯æ”¶åˆ°é€šçŸ¥ï¼š"åŒ»ç”Ÿè°ƒæ•´äº†æ‚¨çš„åº·å¤è®¡åˆ’"

---

### ä¸‰ã€è§†é¢‘å®¡æ ¸æµç¨‹

#### æµç¨‹æè¿°
æ‚£è€…ä¸Šä¼ è®­ç»ƒè§†é¢‘åï¼ŒåŒ»ç”Ÿå®¡æ ¸å¹¶ç»™å‡ºç‚¹è¯„ï¼Œæ‚£è€…æŸ¥çœ‹å®¡æ ¸ç»“æœã€‚

#### è¯¦ç»†æ­¥éª¤

**é˜¶æ®µ1ï¼šè§†é¢‘ä¸Šä¼ **
1. æ‚£è€…å®Œæˆè®­ç»ƒï¼Œå½•åˆ¶è§†é¢‘
2. æ·»åŠ æ–‡å­—è¯´æ˜ï¼ˆå¦‚"ä»Šå¤©æ„Ÿè§‰å³è‡‚æœ‰äº›é…¸ç—›"ï¼‰
3. ç‚¹å‡»"ä¸Šä¼ è§†é¢‘"ï¼š
   - ä¿å­˜è§†é¢‘åˆ°æœ¬åœ°å­˜å‚¨
   - åˆ›å»º TrainingVideo è®°å½•
   - è®¾ç½® `status = "pending"`
   - å…³è” TaskInstance
4. ç”ŸæˆåŒ»ç”Ÿä»»åŠ¡ï¼š
   - ç±»å‹ï¼š`review_video`
   - å…³è”è§†é¢‘ID
   - å¦‚æœæ‚£è€…è¯´æ˜ä¸­åŒ…å«"ç–¼ç—›"ç­‰å…³é”®è¯ï¼Œè®¾ç½® `priority = "urgent"`

**é˜¶æ®µ2ï¼šåŒ»ç”Ÿå®¡æ ¸**
1. åŒ»ç”Ÿæ”¶åˆ°é€šçŸ¥ï¼š"[æ‚£è€…å§“å] ä¸Šä¼ äº†æ–°çš„è®­ç»ƒè§†é¢‘"
2. åŒ»ç”Ÿè¿›å…¥è§†é¢‘å®¡æ ¸é¡µé¢
3. æ’­æ”¾è§†é¢‘ï¼ŒæŸ¥çœ‹æ‚£è€…è¯´æ˜
4. å¡«å†™å®¡æ ¸è¡¨å•ï¼š
   - å®¡æ ¸ç»“æœï¼šé€šè¿‡ / éœ€æ”¹è¿›
   - æ–‡å­—ç‚¹è¯„
   - è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼Œå¯é€‰ï¼‰
5. æäº¤å®¡æ ¸ï¼š
   - æ›´æ–° TrainingVideoï¼š
     - `status = "approved"` æˆ– `"needs_improvement"`
     - `reviewedBy = åŒ»ç”Ÿå·¥å·`
     - `reviewedAt = å½“å‰æ—¶é—´`
     - `reviewComment = ç‚¹è¯„å†…å®¹`
     - `rating = è¯„åˆ†`
   - åˆ é™¤åŒ»ç”Ÿä»»åŠ¡
   - æ‚£è€…ç«¯æ”¶åˆ°é€šçŸ¥ï¼š"æ‚¨çš„è®­ç»ƒè§†é¢‘å·²å®¡æ ¸"

**é˜¶æ®µ3ï¼šæ‚£è€…æŸ¥çœ‹ç»“æœ**
1. æ‚£è€…ç‚¹å‡»é€šçŸ¥ï¼Œè¿›å…¥è§†é¢‘è¯¦æƒ…é¡µ
2. æŸ¥çœ‹å®¡æ ¸çŠ¶æ€ã€åŒ»ç”Ÿç‚¹è¯„ã€è¯„åˆ†
3. å¦‚æœæ˜¯"éœ€æ”¹è¿›"ï¼Œæ‚£è€…å¯ä»¥é‡æ–°å½•åˆ¶

#### å®¡æ ¸ä¼˜å…ˆçº§
- ç´§æ€¥è§†é¢‘ï¼ˆæ‚£è€…åé¦ˆç–¼ç—›ï¼‰ä¼˜å…ˆæ˜¾ç¤º
- æŒ‰ä¸Šä¼ æ—¶é—´å€’åºæ’åˆ—

---

### å››ã€æ‚£è€…åé¦ˆä¸åŒ»ç”Ÿå›å¤æµç¨‹

#### æµç¨‹æè¿°
æ‚£è€…ä¸»åŠ¨å‘é€åé¦ˆç»™åŒ»ç”Ÿï¼ŒåŒ»ç”ŸæŸ¥çœ‹å¹¶å›å¤ã€‚

#### è¯¦ç»†æ­¥éª¤

**é˜¶æ®µ1ï¼šæ‚£è€…å‘é€åé¦ˆ**
1. æ‚£è€…åœ¨"åŒ»ç”Ÿåé¦ˆ"é¡µé¢ç‚¹å‡»"å‘é€åé¦ˆ"
2. å¡«å†™åé¦ˆè¡¨å•ï¼š
   - åé¦ˆç±»å‹ï¼šç–¼ç—›åé¦ˆ / ç–‘é—® / è¿›åº¦æ±‡æŠ¥ / å…¶ä»–
   - åé¦ˆå†…å®¹
3. æäº¤åé¦ˆï¼š
   - åˆ›å»º PatientFeedback è®°å½•
   - è®¾ç½® `status = "unread"`
   - å¦‚æœç±»å‹æ˜¯"ç–¼ç—›åé¦ˆ"ï¼Œè®¾ç½® `priority = "urgent"`
4. ç”ŸæˆåŒ»ç”Ÿä»»åŠ¡ï¼š
   - ç±»å‹ï¼š`reply_feedback`
   - å…³è”åé¦ˆID
   - ä¼˜å…ˆçº§ç»§æ‰¿åé¦ˆçš„ä¼˜å…ˆçº§

**é˜¶æ®µ2ï¼šåŒ»ç”Ÿå›å¤**
1. åŒ»ç”Ÿæ”¶åˆ°é€šçŸ¥ï¼š"[æ‚£è€…å§“å] å‘é€äº†æ–°çš„åé¦ˆ"
2. åŒ»ç”Ÿè¿›å…¥åé¦ˆè¯¦æƒ…é¡µ
3. æŸ¥çœ‹åé¦ˆå†…å®¹ã€æ‚£è€…ä¿¡æ¯ã€å†å²å¯¹è¯
4. å¡«å†™å›å¤å†…å®¹
5. æäº¤å›å¤ï¼š
   - æ›´æ–° PatientFeedbackï¼š
     - `status = "replied"`
     - `replyContent = å›å¤å†…å®¹`
     - `repliedAt = å½“å‰æ—¶é—´`
   - åˆ é™¤åŒ»ç”Ÿä»»åŠ¡
   - æ‚£è€…ç«¯æ”¶åˆ°é€šçŸ¥ï¼š"åŒ»ç”Ÿå·²å›å¤æ‚¨çš„åé¦ˆ"

**é˜¶æ®µ3ï¼šæ‚£è€…æŸ¥çœ‹å›å¤**
1. æ‚£è€…ç‚¹å‡»é€šçŸ¥ï¼Œè¿›å…¥åé¦ˆè¯¦æƒ…é¡µ
2. æŸ¥çœ‹åŒ»ç”Ÿå›å¤

#### ç‰¹æ®Šå¤„ç†
- ç–¼ç—›åé¦ˆè‡ªåŠ¨æ ‡è®°ä¸ºç´§æ€¥ï¼Œä¼˜å…ˆæ˜¾ç¤º
- åŒ»ç”Ÿå¯ä»¥å°†åé¦ˆè½¬ä¸ºä»»åŠ¡ï¼ˆå¦‚éœ€è¦è°ƒæ•´è®¡åˆ’ï¼‰

---

### äº”ã€ä»»åŠ¡ç”Ÿæˆé€»è¾‘

#### è§¦å‘æ—¶æœº
æ‚£è€…ç™»å½•æ—¶ï¼Œç³»ç»Ÿæ£€æŸ¥å¹¶ç”Ÿæˆä»Šæ—¥ä»»åŠ¡ã€‚

#### ç”Ÿæˆç®—æ³•

```
å‡½æ•°ï¼šgenerateTodayTasks(patientId, today)

1. æŸ¥è¯¢æ‚£è€…çš„æ‰€æœ‰æ´»è·ƒè®¡åˆ’
   plans = æŸ¥è¯¢ RehabPlan WHERE patientId = patientId AND status = "active"

2. éå†æ¯ä¸ªè®¡åˆ’
   FOR EACH plan IN plans:
       
       3. æŸ¥è¯¢è®¡åˆ’çš„æ‰€æœ‰ä»»åŠ¡æ¨¡æ¿
       tasks = æŸ¥è¯¢ TrainingTask WHERE planId = plan.planId
       
       4. éå†æ¯ä¸ªä»»åŠ¡æ¨¡æ¿
       FOR EACH task IN tasks:
           
           5. æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç”Ÿæˆè¯¥ä»»åŠ¡çš„å®ä¾‹
           existingInstance = æŸ¥è¯¢ TaskInstance 
               WHERE taskId = task.taskId 
               AND scheduledDate = today
           
           6. å¦‚æœå·²å­˜åœ¨ï¼Œè·³è¿‡
           IF existingInstance EXISTS:
               CONTINUE
           
           7. åˆ¤æ–­ä»Šå¤©æ˜¯å¦éœ€è¦ç”Ÿæˆä»»åŠ¡
           IF shouldGenerateToday(task, today):
               
               8. åˆ›å»ºä»»åŠ¡å®ä¾‹
               instance = æ–°å»º TaskInstance
               instance.taskId = task.taskId
               instance.patientId = patientId
               instance.scheduledDate = today
               instance.status = "pending"
               
               9. ä¿å­˜åˆ°æ•°æ®åº“
               æ’å…¥ instance
               
               10. æ›´æ–°æ‚£è€…çš„ä»Šæ—¥ä»»åŠ¡æ€»æ•°
               æ‚£è€….todayTasksTotal += 1

11. è¿”å›ç”Ÿæˆçš„ä»»åŠ¡æ•°é‡
```

#### é¢‘ç‡åˆ¤æ–­ç®—æ³•

```
å‡½æ•°ï¼šshouldGenerateToday(task, today)

1. è·å–ä»»åŠ¡çš„é¢‘ç‡ç±»å‹
   frequency = task.frequency

2. æ ¹æ®é¢‘ç‡ç±»å‹åˆ¤æ–­
   IF frequency == "daily":
       è¿”å› true  // æ¯å¤©éƒ½ç”Ÿæˆ
   
   ELSE IF frequency == "weekly":
       // æ¯å‘¨ç‰¹å®šå¤©
       weekdays = è§£æ task.frequencyDetail  // å¦‚ "1,3,5"
       todayWeekday = today çš„æ˜ŸæœŸå‡ ï¼ˆ1-7ï¼‰
       è¿”å› todayWeekday IN weekdays
   
   ELSE IF frequency == "interval":
       // é—´éš”å¤©æ•°
       intervalDays = è§£æ task.frequencyDetail  // å¦‚ "2"
       
       // æŸ¥è¯¢è¯¥ä»»åŠ¡çš„æœ€åä¸€æ¬¡å®ä¾‹
       lastInstance = æŸ¥è¯¢ TaskInstance 
           WHERE taskId = task.taskId 
           ORDER BY scheduledDate DESC 
           LIMIT 1
       
       IF lastInstance ä¸å­˜åœ¨:
           è¿”å› true  // ç¬¬ä¸€æ¬¡ç”Ÿæˆ
       
       // è®¡ç®—æ—¥æœŸå·®
       daysDiff = today - lastInstance.scheduledDate
       è¿”å› daysDiff >= intervalDays
   
   ELSE:
       è¿”å› false  // æœªçŸ¥é¢‘ç‡ç±»å‹
```

---

### å…­ã€è¿›åº¦è®¡ç®—é€»è¾‘

#### æœ¬å‘¨å®Œæˆç‡è®¡ç®—

```
å‡½æ•°ï¼šcalculateWeeklyCompletionRate(patientId)

1. è·å–æœ¬å‘¨çš„æ—¥æœŸèŒƒå›´
   weekStart = æœ¬å‘¨ä¸€çš„æ—¥æœŸ
   weekEnd = æœ¬å‘¨æ—¥çš„æ—¥æœŸ

2. æŸ¥è¯¢æœ¬å‘¨çš„æ‰€æœ‰ä»»åŠ¡å®ä¾‹
   instances = æŸ¥è¯¢ TaskInstance 
       WHERE patientId = patientId 
       AND scheduledDate BETWEEN weekStart AND weekEnd

3. ç»Ÿè®¡å®Œæˆçš„ä»»åŠ¡æ•°
   completedCount = COUNT(instances WHERE status = "completed")

4. ç»Ÿè®¡æ€»ä»»åŠ¡æ•°
   totalCount = COUNT(instances)

5. è®¡ç®—å®Œæˆç‡
   IF totalCount == 0:
       è¿”å› 0
   ELSE:
       completionRate = (completedCount / totalCount) * 100
       è¿”å› completionRate

6. æ›´æ–°æ‚£è€…è®°å½•
   æ›´æ–° Patient SET weeklyCompletionRate = completionRate
```

#### æ€»ä½“åº·å¤è¿›åº¦è®¡ç®—

```
å‡½æ•°ï¼šcalculateOverallProgress(patientId)

1. è·å–æ‚£è€…çš„åº·å¤å¼€å§‹æ—¥æœŸå’Œè®¡åˆ’ç»“æŸæ—¥æœŸ
   patient = æŸ¥è¯¢ Patient WHERE patientId = patientId
   startDate = patient.rehabStartDate
   
   // è·å–æœ€æ™šçš„è®¡åˆ’ç»“æŸæ—¥æœŸ
   endDate = æŸ¥è¯¢ MAX(endDate) FROM RehabPlan 
       WHERE patientId = patientId AND status = "active"

2. è®¡ç®—æ€»å¤©æ•°å’Œå·²è¿‡å¤©æ•°
   totalDays = endDate - startDate
   elapsedDays = today - startDate

3. è®¡ç®—è¿›åº¦
   IF totalDays == 0:
       è¿”å› 0
   ELSE:
       progress = (elapsedDays / totalDays) * 100
       progress = MIN(progress, 100)  // ä¸è¶…è¿‡100%
       è¿”å› progress

4. æ›´æ–°æ‚£è€…è®°å½•
   æ›´æ–° Patient SET overallProgress = progress
```

#### åº·å¤å¤©æ•°è®¡ç®—

```
å‡½æ•°ï¼šcalculateRehabDays(patientId)

1. è·å–æ‚£è€…çš„åº·å¤å¼€å§‹æ—¥æœŸ
   patient = æŸ¥è¯¢ Patient WHERE patientId = patientId
   startDate = patient.rehabStartDate

2. è®¡ç®—å¤©æ•°å·®
   rehabDays = today - startDate

3. æ›´æ–°æ‚£è€…è®°å½•
   æ›´æ–° Patient SET rehabDays = rehabDays
```

#### ä»Šæ—¥ä»»åŠ¡ç»Ÿè®¡

```
å‡½æ•°ï¼šupdateTodayTasksCount(patientId)

1. æŸ¥è¯¢ä»Šæ—¥çš„æ‰€æœ‰ä»»åŠ¡å®ä¾‹
   instances = æŸ¥è¯¢ TaskInstance 
       WHERE patientId = patientId 
       AND scheduledDate = today

2. ç»Ÿè®¡å®Œæˆçš„ä»»åŠ¡æ•°
   completedCount = COUNT(instances WHERE status = "completed")

3. ç»Ÿè®¡æ€»ä»»åŠ¡æ•°
   totalCount = COUNT(instances)

4. æ›´æ–°æ‚£è€…è®°å½•
   æ›´æ–° Patient SET 
       todayTasksCompleted = completedCount,
       todayTasksTotal = totalCount
```

---

### ä¸ƒã€æ’è¡Œæ¦œç”Ÿæˆé€»è¾‘

#### è§¦å‘æ—¶æœº
æ¯å‘¨ä¸€å‡Œæ™¨è‡ªåŠ¨æ‰§è¡Œï¼ˆä½¿ç”¨ WorkManager å®šæ—¶ä»»åŠ¡ï¼‰

#### ç”Ÿæˆç®—æ³•

```
å‡½æ•°ï¼šgenerateWeeklyLeaderboard()

1. è·å–ä¸Šå‘¨çš„æ—¥æœŸèŒƒå›´
   weekStart = ä¸Šå‘¨ä¸€çš„æ—¥æœŸ
   weekEnd = ä¸Šå‘¨æ—¥çš„æ—¥æœŸ
   weekNumber = æ ¼å¼åŒ–ä¸º "2024-W03"

2. æŸ¥è¯¢æ‰€æœ‰å‚ä¸æ’è¡Œæ¦œçš„æ‚£è€…
   patients = æŸ¥è¯¢ Patient WHERE joinRanking = true

3. éå†æ¯ä¸ªæ‚£è€…ï¼Œè®¡ç®—ä¸Šå‘¨å®Œæˆç‡
   leaderboardData = []
   
   FOR EACH patient IN patients:
       
       // æŸ¥è¯¢ä¸Šå‘¨çš„ä»»åŠ¡å®ä¾‹
       instances = æŸ¥è¯¢ TaskInstance 
           WHERE patientId = patient.patientId 
           AND scheduledDate BETWEEN weekStart AND weekEnd
       
       // ç»Ÿè®¡å®Œæˆæƒ…å†µ
       completedCount = COUNT(instances WHERE status = "completed")
       totalCount = COUNT(instances)
       
       IF totalCount > 0:
           completionRate = (completedCount / totalCount) * 100
       ELSE:
           completionRate = 0
       
       // æ·»åŠ åˆ°æ’è¡Œæ¦œæ•°æ®
       leaderboardData.ADD({
           patientId: patient.patientId,
           patientName: patient.nickname æˆ– "æ‚£è€…" + patient.patientId,
           completionRate: completionRate,
           completedTasks: completedCount
       })

4. æ’åº
   // æŒ‰å®Œæˆç‡é™åºï¼Œå®Œæˆç‡ç›¸åŒæŒ‰å®Œæˆä»»åŠ¡æ•°é™åº
   leaderboardData.SORT BY completionRate DESC, completedTasks DESC

5. åˆ†é…æ’å
   rank = 1
   FOR EACH data IN leaderboardData:
       data.rank = rank
       rank += 1

6. ä¿å­˜åˆ°æ•°æ®åº“
   FOR EACH data IN leaderboardData:
       æ’å…¥ Leaderboard {
           weekNumber: weekNumber,
           patientId: data.patientId,
           patientName: data.patientName,
           completionRate: data.completionRate,
           completedTasks: data.completedTasks,
           rank: data.rank
       }

7. æ¸…ç†æ—§æ•°æ®ï¼ˆå¯é€‰ï¼‰
   // åªä¿ç•™æœ€è¿‘4å‘¨çš„æ’è¡Œæ¦œæ•°æ®
   åˆ é™¤ Leaderboard WHERE weekNumber < (å½“å‰å‘¨æ•° - 4)
```

---

### å…«ã€é€šçŸ¥ç”Ÿæˆé€»è¾‘

#### é€šçŸ¥è§¦å‘åœºæ™¯

**åŒ»ç”Ÿç«¯é€šçŸ¥**ï¼š
1. æ–°æ‚£è€…ç”³è¯·ï¼šæ‚£è€…ç»‘å®šåŒ»ç”Ÿæ—¶
2. æ–°è§†é¢‘å¾…å®¡æ ¸ï¼šæ‚£è€…ä¸Šä¼ è§†é¢‘æ—¶
3. æ–°åé¦ˆå¾…å›å¤ï¼šæ‚£è€…å‘é€åé¦ˆæ—¶
4. æ‚£è€…å®Œæˆä»»åŠ¡ï¼šæ‚£è€…å®Œæˆä»Šæ—¥æ‰€æœ‰ä»»åŠ¡æ—¶ï¼ˆå¯é€‰ï¼‰

**æ‚£è€…ç«¯é€šçŸ¥**ï¼š
1. åŒ»ç”Ÿç¡®è®¤ç»‘å®šï¼šåŒ»ç”Ÿç¡®è®¤æ¥æ”¶æ‚£è€…æ—¶
2. è§†é¢‘å®¡æ ¸å®Œæˆï¼šåŒ»ç”Ÿå®¡æ ¸è§†é¢‘å
3. åŒ»ç”Ÿå›å¤åé¦ˆï¼šåŒ»ç”Ÿå›å¤åé¦ˆå
4. è®¡åˆ’è°ƒæ•´ï¼šåŒ»ç”Ÿè°ƒæ•´åº·å¤è®¡åˆ’å
5. æ–°ä»»åŠ¡æé†’ï¼šæ¯å¤©æ—©ä¸Š8ç‚¹
6. è®­ç»ƒæé†’ï¼šä»»åŠ¡è®¡åˆ’æ—¶é—´å‰15åˆ†é’Ÿ

#### é€šçŸ¥ç”Ÿæˆå‡½æ•°

```
å‡½æ•°ï¼šsendNotification(userId, title, content, type, relatedId)

1. åˆ›å»ºæœ¬åœ°é€šçŸ¥
   notification = æ–°å»º Notification
   notification.title = title
   notification.content = content
   notification.type = type
   notification.relatedId = relatedId

2. æ˜¾ç¤ºé€šçŸ¥
   NotificationManager.notify(notification)

3. ä¿å­˜é€šçŸ¥è®°å½•ï¼ˆå¯é€‰ï¼‰
   æ’å…¥ NotificationRecord {
       userId: userId,
       title: title,
       content: content,
       type: type,
       relatedId: relatedId,
       isRead: false,
       createdAt: å½“å‰æ—¶é—´
   }
```

---

### ä¹ã€æ•°æ®åŒæ­¥ä¸æ›´æ–°ç­–ç•¥

#### å†—ä½™å­—æ®µæ›´æ–°æ—¶æœº

**æ‚£è€…å®Œæˆä»»åŠ¡æ—¶**ï¼š
```
1. æ›´æ–° TaskInstance.status = "completed"
2. æ›´æ–° Patient.todayTasksCompleted += 1
3. é‡æ–°è®¡ç®— Patient.weeklyCompletionRate
4. æ›´æ–° Patient.lastActiveTime = å½“å‰æ—¶é—´
```

**åŒ»ç”Ÿå®¡æ ¸è§†é¢‘æ—¶**ï¼š
```
1. æ›´æ–° TrainingVideo.status = "approved" æˆ– "needs_improvement"
2. æ›´æ–° TrainingVideo.reviewedByã€reviewedAtã€reviewCommentã€rating
```

**æ‚£è€…å‘é€åé¦ˆæ—¶**ï¼š
```
1. åˆ›å»º PatientFeedback è®°å½•
2. æ›´æ–° Patient.hasNewFeedback = true
```

**åŒ»ç”Ÿå›å¤åé¦ˆæ—¶**ï¼š
```
1. æ›´æ–° PatientFeedback.status = "replied"
2. æ›´æ–° PatientFeedback.replyContentã€repliedAt
3. æ›´æ–° Patient.hasNewFeedback = falseï¼ˆå¦‚æœæ²¡æœ‰å…¶ä»–æœªè¯»åé¦ˆï¼‰
```

**åŒ»ç”Ÿç¡®è®¤æ‚£è€…æ—¶**ï¼š
```
1. æ›´æ–° Patient.bindingStatus = "active"
2. æ›´æ–° Doctor.patientCount += 1
```

**å¸–å­è¢«ç‚¹èµæ—¶**ï¼š
```
1. åˆ›å»º Like è®°å½•
2. æ›´æ–° Post.likeCount += 1
```

**å¸–å­è¢«è¯„è®ºæ—¶**ï¼š
```
1. åˆ›å»º Comment è®°å½•
2. æ›´æ–° Post.commentCount += 1
```

#### å®šæ—¶ä»»åŠ¡

**æ¯å¤©å‡Œæ™¨æ‰§è¡Œ**ï¼š
1. ä¸ºæ‰€æœ‰æ‚£è€…ç”Ÿæˆä»Šæ—¥ä»»åŠ¡ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥åœ¨ç™»å½•æ—¶ç”Ÿæˆï¼‰
2. è®¡ç®—å¹¶æ›´æ–°æ‰€æœ‰æ‚£è€…çš„åº·å¤å¤©æ•°
3. æ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆå¦‚30å¤©å‰çš„èŠå¤©è®°å½•ï¼‰

**æ¯å‘¨ä¸€å‡Œæ™¨æ‰§è¡Œ**ï¼š
1. ç”Ÿæˆä¸Šå‘¨çš„æ’è¡Œæ¦œ
2. é‡ç½®æ‰€æœ‰æ‚£è€…çš„æœ¬å‘¨å®Œæˆç‡

**æ¯æœˆ1å·å‡Œæ™¨æ‰§è¡Œ**ï¼š
1. é‡ç½®æ‰€æœ‰åŒ»ç”Ÿçš„æœ¬æœˆå®Œæˆè®¡åˆ’æ•°
2. ç”Ÿæˆæœˆåº¦ç»Ÿè®¡æŠ¥å‘Šï¼ˆå¯é€‰ï¼‰

---

### åã€å¼‚å¸¸å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ

#### æ‚£è€…æœªç»‘å®šåŒ»ç”Ÿ
- ç™»å½•åå¼ºåˆ¶è¿›å…¥ç»‘å®šæµç¨‹
- æœªç»‘å®šå‰æ— æ³•ä½¿ç”¨å…¶ä»–åŠŸèƒ½

#### æ‚£è€…æ²¡æœ‰æ´»è·ƒè®¡åˆ’
- ä»Šæ—¥ä»»åŠ¡åˆ—è¡¨ä¸ºç©º
- æ˜¾ç¤ºæç¤ºï¼š"æš‚æ— è®­ç»ƒè®¡åˆ’ï¼Œè¯·è”ç³»åŒ»ç”Ÿ"

#### ä»»åŠ¡ç”Ÿæˆå¤±è´¥
- è®°å½•é”™è¯¯æ—¥å¿—
- ä¸‹æ¬¡ç™»å½•æ—¶é‡è¯•

#### è§†é¢‘ä¸Šä¼ å¤±è´¥
- ä¿ç•™æœ¬åœ°è§†é¢‘æ–‡ä»¶
- æä¾›"é‡æ–°ä¸Šä¼ "æŒ‰é’®

#### ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼ˆAIèŠå¤©ï¼‰
- æ˜¾ç¤ºé”™è¯¯æç¤ºï¼š"ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"
- ä¿ç•™ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯

#### æ•°æ®åº“æ“ä½œå¤±è´¥
- æ•è·å¼‚å¸¸ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
- è®°å½•é”™è¯¯æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥

#### æ—¥æœŸè®¡ç®—è¾¹ç•Œ
- åº·å¤å¤©æ•°ä¸èƒ½ä¸ºè´Ÿæ•°
- å®Œæˆç‡ä¸èƒ½è¶…è¿‡100%
- è¿›åº¦ä¸èƒ½è¶…è¿‡100%

---

## ğŸ” æ•°æ®éªŒè¯è§„åˆ™

### ç”¨æˆ·è¾“å…¥éªŒè¯

**åŒ»ç”Ÿæ³¨å†Œ/ç™»å½•**ï¼š
- å·¥å·ï¼šéç©ºï¼Œé•¿åº¦6-20ä½
- å¯†ç ï¼šéç©ºï¼Œé•¿åº¦6-20ä½

**æ‚£è€…æ³¨å†Œ/ç™»å½•**ï¼š
- æ‰‹æœºå·ï¼š11ä½æ•°å­—ï¼Œç¬¦åˆæ‰‹æœºå·æ ¼å¼
- å¯†ç ï¼šéç©ºï¼Œé•¿åº¦6-20ä½

**åº·å¤è®¡åˆ’**ï¼š
- è®¡åˆ’åç§°ï¼šéç©ºï¼Œé•¿åº¦1-50å­—ç¬¦
- åº·å¤ç›®æ ‡ï¼šéç©ºï¼Œé•¿åº¦1-200å­—ç¬¦
- å¼€å§‹æ—¥æœŸï¼šä¸èƒ½æ—©äºä»Šå¤©
- ç»“æŸæ—¥æœŸï¼šä¸èƒ½æ—©äºå¼€å§‹æ—¥æœŸ

**è®­ç»ƒä»»åŠ¡**ï¼š
- ä»»åŠ¡åç§°ï¼šéç©ºï¼Œé•¿åº¦1-50å­—ç¬¦
- å»ºè®®æ—¶é•¿ï¼š1-180åˆ†é’Ÿ
- é¢‘ç‡ï¼šå¿…é¡»é€‰æ‹©ä¸€ç§

**åé¦ˆå†…å®¹**ï¼š
- å†…å®¹ï¼šéç©ºï¼Œé•¿åº¦1-500å­—ç¬¦

**å¸–å­å†…å®¹**ï¼š
- å†…å®¹ï¼šéç©ºï¼Œé•¿åº¦1-1000å­—ç¬¦

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
1. ä½¿ç”¨ç´¢å¼•åŠ é€Ÿå¸¸ç”¨æŸ¥è¯¢
2. é¿å… N+1 æŸ¥è¯¢é—®é¢˜
3. ä½¿ç”¨å†—ä½™å­—æ®µå‡å°‘ JOIN æ“ä½œ
4. åˆ†é¡µåŠ è½½å¤§æ•°æ®åˆ—è¡¨

### å†…å­˜ä¼˜åŒ–
1. åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„èµ„æº
2. ä½¿ç”¨ Flow è¿›è¡Œæ•°æ®æµç®¡ç†
3. å›¾ç‰‡ä½¿ç”¨ Glide ç¼“å­˜

### UI ä¼˜åŒ–
1. ä½¿ç”¨ RecyclerView çš„ DiffUtil
2. é¿å…åœ¨ä¸»çº¿ç¨‹è¿›è¡Œè€—æ—¶æ“ä½œ
3. ä½¿ç”¨åç¨‹å¤„ç†å¼‚æ­¥ä»»åŠ¡

---

**æ–‡æ¡£ç»“æŸ**





