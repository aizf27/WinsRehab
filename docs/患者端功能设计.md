# 患者端功能设计文档

## 📋 概述

患者端是 WinsRehab 应用的执行核心，患者通过该端口查看康复计划、完成训练任务、上传训练视频、与医生沟通、获得心理支持，实现康复训练的自主管理。

---

## 🏠 模块一：患者主页

### 功能定位
患者主页是患者登录后的首页，提供康复概览、今日任务、功能入口和数据统计，帮助患者快速了解康复状态并开始训练。

### 核心功能

#### 1. 顶部工具栏
- 应用标题："康复助手"
- 通知图标：显示未读通知数量（红点）
- 切换账户按钮

#### 2. 欢迎卡片（绿色渐变）
**展示内容**：
- 问候语（根据时间显示：早上好/中午好/下午好/晚上好）
- 患者姓名
- 康复天数提示（如"今天是康复训练的第 28 天，继续加油！"）

**三列数据统计**：
- 本周完成率（如"85%"）
- 累计天数（如"28天"）
- 今日任务（如"2/4"，表示完成2个，共4个任务）

**数据来源**：
- 康复天数：从康复开始日期计算到今天
- 本周完成率：本周已完成任务数 / 本周总任务数
- 今日任务：今天已完成任务数 / 今天总任务数

#### 3. 今日任务列表
展示今天需要完成的训练任务：

**任务卡片设计**：
- 左侧彩色边框（绿色=进行中，黄色=待完成，灰色=已完成）
- 任务图标（圆形背景，带颜色）
- 任务名称（如"上肢功能训练"）
- 建议时长（如"建议时长：30分钟"）
- 计划时间（如"上午 10:00 - 10:30"）
- 状态按钮（"开始"/"待完成"/"已完成"）

**任务状态**：
- 待完成：黄色边框，显示"待完成"按钮
- 进行中：绿色边框，显示"开始"按钮
- 已完成：灰色边框，显示"已完成"标记

**交互**：
- 点击"开始"按钮：跳转到康复中心页面，开始该任务
- 点击任务卡片：查看任务详情

#### 4. 功能卡片网格（2x2）
四个主要功能入口，采用渐变卡片设计：

**心理助手（紫色渐变）**
- 图标：心理咨询图标
- 标题："心理助手"
- 描述："AI陪伴，倾听心声"
- 状态："随时可用"
- 点击：跳转到心理助手聊天页面

**训练视频库（蓝色渐变）**
- 图标：视频图标
- 标题："训练视频库"
- 描述："专业指导视频"
- 统计："120+ 视频"
- 点击：跳转到示范视频库

**病友社区（橙色渐变）**
- 图标：用户组图标
- 标题："病友社区"
- 描述："分享经验，互相鼓励"
- 功能："排行榜"
- 点击：跳转到病友社区

**医生反馈（青色渐变）**
- 图标：听诊器图标
- 标题："医生反馈"
- 描述："李医生的专业建议"
- 角标：显示未读反馈数量（如"3"）
- 点击：跳转到医生反馈页面

#### 5. 康复进度卡片
展示本周康复进度：

**进度统计**：
- 本周完成率（大字显示，如"85%"）
- 趋势图标（上升箭头）
- 水平进度条（绿色）
- 文字说明（如"已完成 6/7 项训练任务"）

**本周柱状图**：
- 七个柱状条，代表周一到周日
- 每个柱状条显示当天的完成情况
- 高度代表完成度
- 今天的柱状条高亮显示

#### 6. 快捷功能
三个快捷按钮：
- 训练日历：查看训练日历和历史记录
- 健康数据：查看健康数据统计
- 康复中心：快速进入康复中心

### UI 对应
`fragment_pt_home.xml`

---

## 🏋️ 模块二：康复中心（训练执行）

### 功能定位
康复中心是患者执行训练任务的核心模块，患者在这里录制训练视频、上传给医生审核、查看训练记录。

### 核心功能

#### 1. 顶部工具栏
- 图标 + 标题："康复中心"
- 副标题："第 28 天 · 继续加油"
- 切换账户按钮

#### 2. 今日进度卡片（绿色渐变）
**展示内容**：
- 标题："今日训练进度"
- 完成情况（如"2/4 项已完成"）
- 完成率（如"完成率: 50%"）
- 趋势图标
- 水平进度条（白色，显示完成百分比）

#### 3. 录制操作卡片
这是核心功能区域，有两个状态：

**状态1：未录制（默认）**
- 大圆形图标（绿色背景，视频图标）
- 标题："开始康复训练"
- 描述："点击开始录制您的康复训练视频"
- 大按钮："▶ 开始康复训练"

**状态2：录制中**
- 红色脉冲圆圈（视频图标）
- 文字："录制中..."
- 大按钮："⏸ 停止录制"（红色）

**交互流程**：
```
1. 患者点击"开始康复训练"
2. 弹出任务选择对话框（显示今日待完成的任务）
3. 患者选择要完成的任务（如"上肢功能训练"）
4. 进入录制界面（调用相机）
5. 开始录制，界面切换到"录制中"状态
6. 患者完成训练后点击"停止录制"
7. 进入预览页面
```

#### 4. 录制预览页面
停止录制后进入预览页面：

**视频预览**：
- 播放刚录制的视频
- 支持重新录制

**添加说明**：
- 文本输入框（多行）
- 提示："添加训练说明或反馈（可选）"
- 例如："今天感觉右臂有些酸痛，但能坚持完成"

**操作按钮**：
- 重新录制：返回录制界面
- 上传视频：保存视频并上传

#### 5. 上传处理
点击"上传视频"后：
- 显示上传进度条
- 上传完成后提示："视频上传成功，等待医生审核"
- 任务状态更新为"已完成，待审核"
- 今日进度自动更新
- 返回康复中心主页

#### 6. 今日训练计划列表
显示今天的所有训练任务：

**任务项展示**：
- 任务图标
- 任务名称
- 建议时长
- 完成状态（待完成/已完成/已审核）
- 操作按钮（"开始训练"/"查看点评"）

**任务状态说明**：
- 待完成：灰色，显示"开始训练"按钮
- 已完成待审核：黄色，显示"待审核"标记
- 已审核：绿色，显示"查看点评"按钮

**交互**：
- 点击"开始训练"：进入录制流程
- 点击"查看点评"：查看医生的审核点评

#### 7. 本周完成情况
柱状图展示本周每天的完成情况：
- 七个柱状条（周一到周日）
- 每个柱状条显示当天完成的任务数量
- 今天的柱状条高亮显示

#### 8. 底部统计卡片
三个统计卡片：
- 本周完成：本周完成的任务总数
- 累计时长：累计训练时长
- 连续天数：连续训练天数

### 技术实现要点

#### 视频录制
- 使用 CameraX 或 MediaRecorder
- 限制分辨率：720p（平衡质量和文件大小）
- 限制时长：最长5分钟
- 支持前置/后置摄像头切换

#### 视频压缩
- 录制完成后自动压缩
- 使用 MediaCodec 或 FFmpeg
- 目标：将文件大小控制在合理范围

#### 视频存储
- 初期：本地存储（应用私有目录）
- 文件命名：patientId_taskId_timestamp.mp4
- 存储路径保存到数据库

#### 上传机制（暂不实现）
- 后期扩展：上传到云存储
- 显示上传进度
- 支持断点续传

### UI 对应
`fragment_pt_rehab.xml`

---

## 📋 模块三：我的康复计划

### 功能定位
患者查看医生为自己制定的康复计划，了解康复目标、训练任务和完成情况。

### 核心功能

#### 1. 计划列表
如果患者有多个康复计划，以列表形式展示：

**计划卡片**：
- 计划名称（如"脑卒中上肢康复计划"）
- 计划状态（进行中/已完成）
- 计划周期（如"2024-01-15 至 2024-03-15"）
- 总体进度条（如"65%"）
- 点击：查看计划详情

#### 2. 计划详情页
点击计划后进入详情页：

**计划基本信息**：
- 计划名称
- 康复目标（如"恢复上肢功能，提升日常生活能力"）
- 计划周期
- 制定医生
- 总体进度条

**训练任务列表**：
每个任务以卡片形式展示：
- 任务名称（如"上肢功能训练"）
- 任务类型（上肢/下肢/全身等）
- 执行规则（如"每天1次，30分钟"）
- 本周完成情况（如"本周完成 6/7"）
- 完成状态图标（✅/⏳/❌）

**任务详情**：
点击任务可以查看：
- 任务描述（详细说明训练内容和注意事项）
- 参考视频（如果医生添加了）
- 历史完成记录
- 医生点评记录

#### 3. 计划调整记录
如果医生调整过计划，显示调整记录：
- 调整时间
- 调整内容（如"增加了'手指灵活性训练'任务"）
- 调整原因（医生填写的说明）

#### 4. 计划统计
- 计划总天数
- 已执行天数
- 总任务数
- 已完成任务数
- 完成率

---

## 🎥 模块四：视频审核结果

### 功能定位
患者查看自己上传的训练视频和医生的审核点评，了解训练效果和改进方向。

### 核心功能

#### 1. 视频列表
展示患者上传的所有视频：

**列表信息**：
- 视频缩略图
- 任务名称（如"上肢功能训练"）
- 上传日期
- 审核状态（待审核/已通过/需改进）
- 评分（如果有）

**状态标识**：
- 待审核：黄色标签
- 已通过：绿色标签 + ✅
- 需改进：橙色标签 + ⚠️

**排序**：
- 按上传时间倒序

#### 2. 视频详情页
点击视频进入详情页：

**视频播放器**：
- 播放训练视频
- 支持暂停、快进、全屏

**视频信息**：
- 任务名称
- 上传时间
- 视频时长
- 患者说明（上传时填写的文字）

**医生审核结果**：
- 审核状态（已通过/需改进）
- 审核时间
- 医生姓名
- 评分（星级）
- 医生点评（完整文字）

**点评展示**：
```
医生点评：
"动作基本标准，但注意不要过度用力。
建议：
1. 适当降低训练强度
2. 每次训练前做好热身
3. 如果疼痛持续，请及时反馈

继续加油！💪"
```

#### 3. 历史对比
如果同一任务有多次视频记录，可以对比：
- 显示最近3次的视频
- 对比医生评分的变化
- 查看进步趋势

---

## 💬 模块五：心理助手（AI聊天）

### 功能定位
为患者提供24小时的心理支持和陪伴，通过AI对话缓解患者的焦虑和压力。

### 核心功能

#### 1. 聊天界面
标准的聊天界面设计：

**消息列表**：
- 用户消息：右侧，蓝色气泡
- AI消息：左侧，白色气泡
- 显示发送时间
- 支持滚动查看历史消息

**输入区域**：
- 文本输入框
- 发送按钮
- 支持多行输入

#### 2. AI 角色设定
AI 扮演康复心理咨询师：
- 温暖、耐心、专业的语气
- 提供心理支持和鼓励
- 给出实用的建议（但不涉及医疗诊断）
- 倾听患者的困扰和焦虑

**Prompt 设计**：
```
你是一位专业的康复心理咨询师，患者正在进行康复训练。
你的任务是：
1. 倾听患者的困扰和焦虑
2. 提供积极的心理支持和鼓励
3. 给出实用的建议（但不涉及医疗诊断）
4. 保持温暖、耐心、专业的语气

患者信息：
- 姓名：[患者姓名]
- 诊断：[诊断信息]
- 康复天数：[天数]
- 本周完成率：[百分比]
```

#### 3. 预设问题（可选）
为了方便患者，提供一些预设问题：
- "我感觉康复进度很慢，怎么办？"
- "训练时总是感到疼痛，是否正常？"
- "我担心无法完全康复，怎么调整心态？"
- "如何保持训练的动力？"

点击预设问题，自动发送给AI

#### 4. 聊天记录保存
- 聊天记录保存到本地数据库
- 下次打开时可以查看历史对话
- 支持清空聊天记录

#### 5. 使用提示
首次进入时显示使用提示：
- "我是您的心理助手，随时倾听您的心声"
- "您可以和我聊聊康复过程中的感受和困扰"
- "我会尽力为您提供支持和建议"

### 技术实现
- 已集成 DeepSeek API
- 使用 OkHttp 发送请求
- 使用 Gson 解析响应
- 聊天记录存储在 Room 数据库

---

## 👥 模块六：病友社区

### 功能定位
为患者提供交流平台，分享康复经验、互相鼓励、查看排行榜，增强康复动力。

### 核心功能

#### 1. 社区首页
**顶部标签**：
- 最新：按发布时间倒序
- 热门：按点赞数排序
- 关注：关注的用户的帖子（可选功能）

**帖子列表**：
每个帖子以卡片形式展示：
- 作者信息（昵称或匿名，如"康复中的小李"）
- 发布时间
- 帖子内容（显示前3行，超出部分省略）
- 点赞数
- 评论数
- 点击：查看帖子详情

#### 2. 发布帖子
点击"发帖"按钮：

**发帖表单**：
- 标题（可选）
- 内容（多行文本输入框）
- 匿名选项（勾选后以匿名身份发布）

**发布后**：
- 帖子立即显示在社区首页
- 提示："发布成功"

#### 3. 帖子详情页
点击帖子进入详情页：

**帖子内容**：
- 作者信息
- 发布时间
- 完整内容

**互动区域**：
- 点赞按钮（点击后变为红色）
- 评论按钮
- 分享按钮（可选）

**评论列表**：
- 显示所有评论
- 每条评论显示：作者、时间、内容
- 支持回复评论

**发表评论**：
- 底部输入框
- 发送按钮
- 支持匿名评论

#### 4. 每周排行榜
展示本周完成率最高的患者：

**排行榜设计**：
- 前三名特殊展示（金银铜牌）
- 显示：排名、昵称、完成率
- 自己的排名高亮显示

**隐私保护**：
- 患者可选择是否参与排行榜
- 排行榜中显示昵称，不显示真实姓名
- 不显示具体诊断信息

**排名计算**：
- 每周一凌晨自动计算
- 基于本周完成率排序
- 完成率相同时，按完成任务数排序

#### 5. 我的帖子
查看自己发布的所有帖子：
- 按时间倒序
- 显示点赞数和评论数
- 支持删除帖子

### 隐私与安全

#### 匿名机制
- 患者可选择显示昵称或完全匿名
- 昵称设置：在个人信息页面设置
- 匿名发帖：系统随机生成匿名ID（如"患者A"）

#### 内容审核（后期优化）
- 敏感词过滤
- 用户举报机制
- 管理员审核

---

## 📚 模块七：示范视频库

### 功能定位
提供专业录制的康复训练示范视频，供患者学习正确的训练方法。

### 核心功能

#### 1. 视频库首页
**顶部筛选**：
- 分类筛选：全部/肩部/腿部/全身/平衡等
- 难度筛选：全部/初级/中级/高级

**视频列表**：
每个视频以卡片形式展示：
- 视频缩略图
- 视频标题（如"肩部康复训练"）
- 分类标签
- 难度标签
- 时长
- 观看次数
- 点击：播放视频

#### 2. 视频播放页面
**视频播放器**：
- 全屏播放
- 支持暂停、快进、后退
- 支持倍速播放
- 显示播放进度

**视频信息**：
- 标题
- 分类
- 难度
- 时长
- 描述（详细说明训练要点和注意事项）

**操作按钮**：
- 收藏：收藏到"我的收藏"
- 分享：分享给其他患者（可选）

#### 3. 我的收藏
查看收藏的视频：
- 按收藏时间倒序
- 支持取消收藏

#### 4. 搜索功能
- 搜索框：按标题或描述搜索
- 搜索历史：显示最近搜索的关键词

### 视频内容建议
- 上肢康复训练
- 下肢康复训练
- 平衡训练
- 协调训练
- 拉伸放松
- 呼吸训练

---

## 💬 模块八：医生反馈

### 功能定位
患者查看医生的所有反馈，包括视频点评和独立回复，也可以主动向医生发送反馈。

### 核心功能

#### 1. 反馈列表
展示所有医生反馈，分为两类：

**视频点评**：
- 图标：📹
- 标题：任务名称 + 日期
- 内容：医生点评的前两行
- 状态：已通过/需改进
- 点击：查看完整点评和视频

**医生回复**：
- 图标：💬
- 标题：反馈主题 + 日期
- 内容：医生回复的前两行
- 点击：查看完整对话

**排序**：
- 按时间倒序

#### 2. 发送反馈
点击"发送反馈"按钮：

**反馈表单**：
- 反馈类型：疼痛反馈/疑问/进度汇报/其他
- 反馈内容：多行文本输入框
- 优先级：普通/紧急（疼痛反馈自动标记为紧急）

**发送后**：
- 提示："反馈已发送，医生会尽快回复"
- 反馈进入医生的待处理队列

#### 3. 反馈详情页
查看完整的反馈对话：

**患者反馈**：
- 反馈类型
- 反馈内容
- 发送时间

**医生回复**：
- 回复内容
- 回复时间
- 医生姓名

**历史对话**：
- 如果有多次往返对话，按时间顺序显示

---

## 👤 模块九：患者信息管理

### 功能定位
患者查看和管理自己的个人信息、康复信息和设置。

### 核心功能

#### 1. 个人资料卡片
顶部渐变卡片展示：
- 头像（圆形）
- 姓名
- 患者ID
- 康复中心

#### 2. 基本信息
列表形式展示，可点击编辑：
- 手机号码
- 电子邮箱
- 出生日期
- 地址

#### 3. 康复信息
列表形式展示：
- 康复记录：查看康复历史
- 训练计划：查看当前计划
- 主治医生：显示医生姓名和工号

**医生工号修改**：
- 患者可以修改医生工号（更换医生）
- 修改后需要新医生确认
- 旧医生收到通知

#### 4. 设置
- 系统设置：通知设置、隐私设置
- 切换账户：退出登录

### UI 对应
`fragment_pt_info.xml`

---

## 🔔 通知系统

### 通知场景

#### 视频审核完成
- 触发：医生审核完成
- 通知内容："您的训练视频已审核，请查看医生点评"
- 点击：跳转到视频详情页

#### 医生回复反馈
- 触发：医生回复患者反馈
- 通知内容："医生已回复您的反馈"
- 点击：跳转到反馈详情页

#### 计划调整
- 触发：医生调整康复计划
- 通知内容："医生调整了您的康复计划，请查看"
- 点击：跳转到计划详情页

#### 新任务提醒
- 触发：每天早上8点
- 通知内容："今天有 4 个训练任务，加油！"
- 点击：跳转到康复中心

#### 训练提醒
- 触发：任务计划时间前15分钟
- 通知内容："上肢功能训练将在15分钟后开始"
- 点击：跳转到康复中心

---

## 📊 数据统计

### 主页统计
- 康复天数
- 本周完成率
- 累计天数
- 今日任务完成情况

### 康复中心统计
- 今日进度
- 本周完成情况
- 本周完成任务数
- 累计训练时长
- 连续训练天数

### 个人统计（可选功能）
- 总训练天数
- 总训练时长
- 总完成任务数
- 平均完成率
- 康复进度趋势图

---

**文档结束**







