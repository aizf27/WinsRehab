# æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿° WinsRehab åº”ç”¨çš„æ•°æ®åº“è®¾è®¡æ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ‰€æœ‰æ•°æ®è¡¨çš„ç»“æ„ã€å­—æ®µè¯´æ˜ã€å…³ç³»è®¾è®¡å’Œç´¢å¼•ä¼˜åŒ–ã€‚

---

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### æŠ€æœ¯é€‰å‹
- **æ•°æ®åº“**ï¼šRoom Databaseï¼ˆåŸºäº SQLiteï¼‰
- **ç‰ˆæœ¬ç®¡ç†**ï¼šMigration æœºåˆ¶
- **æ•°æ®è®¿é—®**ï¼šDAOï¼ˆData Access Objectï¼‰
- **å¼‚æ­¥å¤„ç†**ï¼šKotlin Coroutines + Flow

### æ•°æ®åº“ç‰ˆæœ¬
- **å½“å‰ç‰ˆæœ¬**ï¼š4
- **ç›®æ ‡ç‰ˆæœ¬**ï¼š5ï¼ˆé‡æ„åï¼‰

---

## ğŸ“Š æ•°æ®è¡¨è®¾è®¡

### ä¸€ã€ç”¨æˆ·æ¨¡å—

#### 1. Doctorï¼ˆåŒ»ç”Ÿè¡¨ï¼‰

**è¡¨å**ï¼š`doctor`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| doctorCode | String | PRIMARY KEY | åŒ»ç”Ÿå·¥å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |
| password | String | NOT NULL | å¯†ç ï¼ˆå»ºè®®åŠ å¯†å­˜å‚¨ï¼‰ |
| name | String | NOT NULL | å§“å |
| gender | String | NOT NULL | æ€§åˆ« |
| age | Int | NOT NULL | å¹´é¾„ |
| title | String | NOT NULL | èŒç§°ï¼ˆä¸»æ²»åŒ»å¸ˆã€å‰¯ä¸»ä»»åŒ»å¸ˆç­‰ï¼‰ |
| department | String | NOT NULL | ç§‘å®¤ |
| hospital | String | NOT NULL | æ‰€å±åŒ»é™¢ |
| licenseNumber | String | NOT NULL | åŒ»å¸ˆèµ„æ ¼è¯å· |
| phone | String | NOT NULL | æ‰‹æœºå·ç  |
| email | String | NOT NULL | ç”µå­é‚®ç®± |
| avatar | String | NULLABLE | å¤´åƒURLæˆ–è·¯å¾„ |
| patientCount | Int | DEFAULT 0 | ç®¡ç†æ‚£è€…æ•°ï¼ˆå†—ä½™å­—æ®µï¼‰ |
| monthlyCompletedPlans | Int | DEFAULT 0 | æœ¬æœˆå®Œæˆè®¡åˆ’æ•° |
| satisfactionRate | Float | DEFAULT 0 | æ‚£è€…æ»¡æ„åº¦ï¼ˆ0-100ï¼‰ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |
| updatedAt | Long | NOT NULL | æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: doctorCode
- INDEX: phoneï¼ˆç”¨äºç™»å½•æŸ¥è¯¢ï¼‰

**è¯´æ˜**ï¼š
- `patientCount` æ˜¯å†—ä½™å­—æ®µï¼Œé¿å…é¢‘ç¹ COUNT æŸ¥è¯¢
- `satisfactionRate` åŸºäºæ‚£è€…åé¦ˆè®¡ç®—ï¼Œå®šæœŸæ›´æ–°
- å¯†ç åº”ä½¿ç”¨ SHA-256 åŠ å¯†å­˜å‚¨

---

#### 2. Patientï¼ˆæ‚£è€…è¡¨ï¼‰

**è¡¨å**ï¼š`patient`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| patientId | String | PRIMARY KEY | æ‚£è€…IDï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |
| account | String | NOT NULL, UNIQUE | ç™»å½•è´¦å·ï¼ˆæ‰‹æœºå·ï¼‰ |
| password | String | NOT NULL | å¯†ç  |
| name | String | NOT NULL | å§“å |
| gender | String | NOT NULL | æ€§åˆ« |
| age | Int | NOT NULL | å¹´é¾„ |
| phone | String | NOT NULL | æ‰‹æœºå·ç  |
| email | String | NULLABLE | ç”µå­é‚®ç®± |
| dateOfBirth | String | NULLABLE | å‡ºç”Ÿæ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ |
| address | String | NULLABLE | åœ°å€ |
| avatar | String | NULLABLE | å¤´åƒURLæˆ–è·¯å¾„ |
| nickname | String | NULLABLE | æ˜µç§°ï¼ˆç”¨äºç¤¾åŒºæ˜¾ç¤ºï¼‰ |
| doctorCode | String | NOT NULL | ä¸»æ²»åŒ»ç”Ÿå·¥å·ï¼ˆå¤–é”®ï¼‰ |
| doctorName | String | NOT NULL | ä¸»æ²»åŒ»ç”Ÿå§“å |
| diagnosis | String | NOT NULL | è¯Šæ–­/ç—…æƒ…æè¿° |
| rehabStage | String | NOT NULL | åº·å¤é˜¶æ®µï¼ˆè½¯ç˜«æœŸ/ç—‰æŒ›æœŸ/æ¢å¤æœŸï¼‰ |
| rehabCenter | String | NOT NULL | åº·å¤ä¸­å¿ƒ |
| rehabStartDate | String | NOT NULL | åº·å¤å¼€å§‹æ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ |
| rehabDays | Int | DEFAULT 0 | ç´¯è®¡åº·å¤å¤©æ•°ï¼ˆå†—ä½™å­—æ®µï¼‰ |
| overallProgress | Int | DEFAULT 0 | æ€»ä½“åº·å¤è¿›åº¦ï¼ˆ0-100ï¼‰ |
| weeklyCompletionRate | Float | DEFAULT 0 | æœ¬å‘¨å®Œæˆç‡ï¼ˆ0-100ï¼Œå†—ä½™å­—æ®µï¼‰ |
| todayTasksCompleted | Int | DEFAULT 0 | ä»Šæ—¥å·²å®Œæˆä»»åŠ¡æ•°ï¼ˆå†—ä½™å­—æ®µï¼‰ |
| todayTasksTotal | Int | DEFAULT 0 | ä»Šæ—¥æ€»ä»»åŠ¡æ•°ï¼ˆå†—ä½™å­—æ®µï¼‰ |
| hasAlert | Boolean | DEFAULT false | æ˜¯å¦æœ‰å¼‚å¸¸é¢„è­¦ |
| hasNewFeedback | Boolean | DEFAULT false | æ˜¯å¦æœ‰æ–°åé¦ˆ |
| lastActiveTime | Long | NOT NULL | æœ€åæ´»è·ƒæ—¶é—´æˆ³ |
| bindingStatus | String | DEFAULT "pending" | ç»‘å®šçŠ¶æ€ï¼ˆpending/active/inactiveï¼‰ |
| joinRanking | Boolean | DEFAULT true | æ˜¯å¦å‚ä¸æ’è¡Œæ¦œ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |
| updatedAt | Long | NOT NULL | æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: patientId
- UNIQUE INDEX: account
- INDEX: doctorCodeï¼ˆç”¨äºæŸ¥è¯¢åŒ»ç”Ÿçš„æ‚£è€…åˆ—è¡¨ï¼‰
- INDEX: bindingStatusï¼ˆç”¨äºæŸ¥è¯¢å¾…ç¡®è®¤çš„æ‚£è€…ï¼‰

**è¯´æ˜**ï¼š
- `rehabDays`ã€`weeklyCompletionRate`ã€`todayTasksCompleted`ã€`todayTasksTotal` æ˜¯å†—ä½™å­—æ®µï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- `bindingStatus` ç”¨äºåŒ»æ‚£ç»‘å®šæµç¨‹ï¼špendingï¼ˆå¾…åŒ»ç”Ÿç¡®è®¤ï¼‰â†’ activeï¼ˆå·²ç¡®è®¤ï¼‰â†’ inactiveï¼ˆå·²è§£é™¤ï¼‰
- `joinRanking` æ§åˆ¶æ‚£è€…æ˜¯å¦å‚ä¸æ’è¡Œæ¦œ

---

### äºŒã€åº·å¤è®¡åˆ’æ¨¡å—

#### 3. RehabPlanï¼ˆåº·å¤è®¡åˆ’è¡¨ï¼‰

**è¡¨å**ï¼š`rehab_plan`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| planId | Long | PRIMARY KEY, AUTO_INCREMENT | è®¡åˆ’ID |
| patientId | String | NOT NULL | æ‚£è€…IDï¼ˆå¤–é”®ï¼‰ |
| doctorCode | String | NOT NULL | åˆ¶å®šåŒ»ç”Ÿå·¥å·ï¼ˆå¤–é”®ï¼‰ |
| planName | String | NOT NULL | è®¡åˆ’åç§° |
| goal | String | NOT NULL | åº·å¤ç›®æ ‡ |
| startDate | String | NOT NULL | å¼€å§‹æ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ |
| endDate | String | NOT NULL | ç»“æŸæ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ |
| status | String | DEFAULT "draft" | çŠ¶æ€ï¼ˆdraft/active/completed/cancelledï¼‰ |
| progress | Int | DEFAULT 0 | å®Œæˆè¿›åº¦ï¼ˆ0-100ï¼‰ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |
| updatedAt | Long | NOT NULL | æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: planId
- INDEX: patientIdï¼ˆç”¨äºæŸ¥è¯¢æ‚£è€…çš„è®¡åˆ’åˆ—è¡¨ï¼‰
- INDEX: statusï¼ˆç”¨äºæŸ¥è¯¢æ´»è·ƒè®¡åˆ’ï¼‰

**è¯´æ˜**ï¼š
- ä¸€ä¸ªæ‚£è€…å¯ä»¥æœ‰å¤šä¸ªåº·å¤è®¡åˆ’
- `status` çŠ¶æ€æµè½¬ï¼šdraftï¼ˆè‰ç¨¿ï¼‰â†’ activeï¼ˆæ¿€æ´»ï¼‰â†’ completedï¼ˆå®Œæˆï¼‰/ cancelledï¼ˆå–æ¶ˆï¼‰

---

#### 4. TrainingTaskï¼ˆè®­ç»ƒä»»åŠ¡æ¨¡æ¿è¡¨ï¼‰

**è¡¨å**ï¼š`training_task`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| taskId | Long | PRIMARY KEY, AUTO_INCREMENT | ä»»åŠ¡ID |
| planId | Long | NOT NULL | æ‰€å±è®¡åˆ’IDï¼ˆå¤–é”®ï¼‰ |
| taskName | String | NOT NULL | ä»»åŠ¡åç§° |
| taskType | String | NOT NULL | ä»»åŠ¡ç±»å‹ï¼ˆupper_limb/lower_limb/balance/coordination/full_bodyï¼‰ |
| description | String | NULLABLE | ä»»åŠ¡æè¿° |
| suggestedDuration | Int | NOT NULL | å»ºè®®æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| frequency | String | NOT NULL | æ‰§è¡Œé¢‘ç‡ï¼ˆdaily/weekly/intervalï¼‰ |
| frequencyDetail | String | NULLABLE | é¢‘ç‡è¯¦æƒ…ï¼ˆå¦‚"1,3,5"è¡¨ç¤ºå‘¨ä¸€ä¸‰äº”ï¼‰ |
| priority | String | DEFAULT "normal" | ä¼˜å…ˆçº§ï¼ˆnormal/importantï¼‰ |
| referenceVideoId | Long | NULLABLE | å‚è€ƒè§†é¢‘IDï¼ˆå…³è”DemoVideoï¼‰ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: taskId
- INDEX: planIdï¼ˆç”¨äºæŸ¥è¯¢è®¡åˆ’çš„ä»»åŠ¡åˆ—è¡¨ï¼‰

**è¯´æ˜**ï¼š
- è¿™æ˜¯ä»»åŠ¡æ¨¡æ¿ï¼Œä¸æ˜¯å…·ä½“çš„ä»»åŠ¡å®ä¾‹
- `frequency` ç±»å‹ï¼š
  - dailyï¼šæ¯å¤©æ‰§è¡Œ
  - weeklyï¼šæ¯å‘¨ç‰¹å®šå¤©æ‰§è¡Œï¼ˆfrequencyDetail å­˜å‚¨æ˜ŸæœŸå‡ ï¼Œå¦‚"1,3,5"ï¼‰
  - intervalï¼šé—´éš”å¤©æ•°æ‰§è¡Œï¼ˆfrequencyDetail å­˜å‚¨é—´éš”å¤©æ•°ï¼Œå¦‚"2"ï¼‰

---

#### 5. TaskInstanceï¼ˆä»»åŠ¡å®ä¾‹è¡¨ï¼‰

**è¡¨å**ï¼š`task_instance`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| instanceId | Long | PRIMARY KEY, AUTO_INCREMENT | å®ä¾‹ID |
| taskId | Long | NOT NULL | ä»»åŠ¡æ¨¡æ¿IDï¼ˆå¤–é”®ï¼‰ |
| patientId | String | NOT NULL | æ‚£è€…IDï¼ˆå¤–é”®ï¼‰ |
| scheduledDate | String | NOT NULL | è®¡åˆ’æ—¥æœŸï¼ˆyyyy-MM-ddï¼‰ |
| scheduledTime | String | NULLABLE | è®¡åˆ’æ—¶é—´ï¼ˆHH:mmï¼‰ |
| status | String | DEFAULT "pending" | çŠ¶æ€ï¼ˆpending/completed/skippedï¼‰ |
| completedAt | Long | NULLABLE | å®Œæˆæ—¶é—´æˆ³ |
| actualDuration | Int | NULLABLE | å®é™…æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ |
| videoId | Long | NULLABLE | å…³è”è§†é¢‘IDï¼ˆå¤–é”®ï¼‰ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: instanceId
- INDEX: patientId, scheduledDateï¼ˆç”¨äºæŸ¥è¯¢æŸå¤©çš„ä»»åŠ¡ï¼‰
- INDEX: taskIdï¼ˆç”¨äºæŸ¥è¯¢ä»»åŠ¡çš„æ‰€æœ‰å®ä¾‹ï¼‰
- INDEX: statusï¼ˆç”¨äºç»Ÿè®¡å®Œæˆæƒ…å†µï¼‰

**è¯´æ˜**ï¼š
- è¿™æ˜¯å…·ä½“çš„ä»»åŠ¡å®ä¾‹ï¼Œç”±ç³»ç»Ÿæ ¹æ®ä»»åŠ¡æ¨¡æ¿ç”Ÿæˆ
- æ‚£è€…å®Œæˆçš„æ˜¯ä»»åŠ¡å®ä¾‹ï¼Œä¸æ˜¯ä»»åŠ¡æ¨¡æ¿
- `status` çŠ¶æ€ï¼špendingï¼ˆå¾…å®Œæˆï¼‰â†’ completedï¼ˆå·²å®Œæˆï¼‰/ skippedï¼ˆè·³è¿‡ï¼‰

---

#### 6. PlanAdjustmentï¼ˆè®¡åˆ’è°ƒæ•´è®°å½•è¡¨ï¼‰

**è¡¨å**ï¼š`plan_adjustment`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| adjustmentId | Long | PRIMARY KEY, AUTO_INCREMENT | è°ƒæ•´ID |
| planId | Long | NOT NULL | è®¡åˆ’IDï¼ˆå¤–é”®ï¼‰ |
| doctorCode | String | NOT NULL | è°ƒæ•´åŒ»ç”Ÿå·¥å· |
| adjustmentType | String | NOT NULL | è°ƒæ•´ç±»å‹ï¼ˆadd_task/modify_task/delete_task/change_periodï¼‰ |
| adjustmentDetail | String | NOT NULL | è°ƒæ•´è¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰ |
| reason | String | NULLABLE | è°ƒæ•´åŸå›  |
| createdAt | Long | NOT NULL | è°ƒæ•´æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: adjustmentId
- INDEX: planIdï¼ˆç”¨äºæŸ¥è¯¢è®¡åˆ’çš„è°ƒæ•´å†å²ï¼‰

**è¯´æ˜**ï¼š
- è®°å½•åŒ»ç”Ÿå¯¹è®¡åˆ’çš„æ¯æ¬¡è°ƒæ•´
- `adjustmentDetail` å­˜å‚¨ JSON æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š
  - æ·»åŠ ä»»åŠ¡ï¼š`{"taskName": "æ‰‹æŒ‡çµæ´»æ€§è®­ç»ƒ", "frequency": "daily"}`
  - ä¿®æ”¹ä»»åŠ¡ï¼š`{"taskId": 123, "oldDuration": 30, "newDuration": 20}`

---

### ä¸‰ã€è§†é¢‘æ¨¡å—

#### 7. TrainingVideoï¼ˆåº·å¤è®­ç»ƒè§†é¢‘è¡¨ï¼‰

**è¡¨å**ï¼š`training_video`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| videoId | Long | PRIMARY KEY, AUTO_INCREMENT | è§†é¢‘ID |
| patientId | String | NOT NULL | æ‚£è€…IDï¼ˆå¤–é”®ï¼‰ |
| instanceId | Long | NOT NULL | ä»»åŠ¡å®ä¾‹IDï¼ˆå¤–é”®ï¼‰ |
| videoPath | String | NOT NULL | è§†é¢‘è·¯å¾„ï¼ˆæœ¬åœ°æˆ–URLï¼‰ |
| thumbnailPath | String | NULLABLE | ç¼©ç•¥å›¾è·¯å¾„ |
| duration | Int | NOT NULL | è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰ |
| patientNote | String | NULLABLE | æ‚£è€…è¯´æ˜ï¼ˆä¸Šä¼ æ—¶å¡«å†™ï¼‰ |
| uploadDate | Long | NOT NULL | ä¸Šä¼ æ—¶é—´æˆ³ |
| status | String | DEFAULT "pending" | å®¡æ ¸çŠ¶æ€ï¼ˆpending/approved/needs_improvementï¼‰ |
| reviewedBy | String | NULLABLE | å®¡æ ¸åŒ»ç”Ÿå·¥å· |
| reviewedAt | Long | NULLABLE | å®¡æ ¸æ—¶é—´æˆ³ |
| reviewComment | String | NULLABLE | åŒ»ç”Ÿç‚¹è¯„ |
| rating | Int | NULLABLE | è¯„åˆ†ï¼ˆ1-5æ˜Ÿï¼‰ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: videoId
- INDEX: patientIdï¼ˆç”¨äºæŸ¥è¯¢æ‚£è€…çš„è§†é¢‘åˆ—è¡¨ï¼‰
- INDEX: statusï¼ˆç”¨äºæŸ¥è¯¢å¾…å®¡æ ¸è§†é¢‘ï¼‰
- INDEX: reviewedByï¼ˆç”¨äºæŸ¥è¯¢åŒ»ç”Ÿå®¡æ ¸çš„è§†é¢‘ï¼‰

**è¯´æ˜**ï¼š
- æ¯ä¸ªè§†é¢‘å…³è”ä¸€ä¸ªä»»åŠ¡å®ä¾‹
- `status` çŠ¶æ€æµè½¬ï¼špendingï¼ˆå¾…å®¡æ ¸ï¼‰â†’ approvedï¼ˆé€šè¿‡ï¼‰/ needs_improvementï¼ˆéœ€æ”¹è¿›ï¼‰
- `patientNote` æ˜¯æ‚£è€…ä¸Šä¼ è§†é¢‘æ—¶é™„å¸¦çš„æ–‡å­—è¯´æ˜

---

#### 8. DemoVideoï¼ˆç¤ºèŒƒè§†é¢‘åº“è¡¨ï¼‰

**è¡¨å**ï¼š`demo_video`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| videoId | Long | PRIMARY KEY, AUTO_INCREMENT | è§†é¢‘ID |
| title | String | NOT NULL | è§†é¢‘æ ‡é¢˜ |
| videoPath | String | NOT NULL | è§†é¢‘è·¯å¾„ï¼ˆassetsæˆ–URLï¼‰ |
| thumbnailPath | String | NULLABLE | ç¼©ç•¥å›¾è·¯å¾„ |
| category | String | NOT NULL | åˆ†ç±»ï¼ˆshoulder/leg/balance/full_bodyï¼‰ |
| difficulty | String | NOT NULL | éš¾åº¦ï¼ˆbeginner/intermediate/advancedï¼‰ |
| duration | Int | NOT NULL | æ—¶é•¿ï¼ˆç§’ï¼‰ |
| description | String | NULLABLE | æè¿° |
| viewCount | Int | DEFAULT 0 | è§‚çœ‹æ¬¡æ•° |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: videoId
- INDEX: categoryï¼ˆç”¨äºåˆ†ç±»ç­›é€‰ï¼‰
- INDEX: difficultyï¼ˆç”¨äºéš¾åº¦ç­›é€‰ï¼‰

**è¯´æ˜**ï¼š
- è¿™æ˜¯ä¾›æ‰€æœ‰æ‚£è€…å­¦ä¹ çš„ç¤ºèŒƒè§†é¢‘
- ç‹¬ç«‹äºæ‚£è€…çš„åº·å¤è§†é¢‘

---

### å››ã€åé¦ˆæ¨¡å—

#### 9. PatientFeedbackï¼ˆæ‚£è€…åé¦ˆè¡¨ï¼‰

**è¡¨å**ï¼š`patient_feedback`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| feedbackId | Long | PRIMARY KEY, AUTO_INCREMENT | åé¦ˆID |
| patientId | String | NOT NULL | æ‚£è€…IDï¼ˆå¤–é”®ï¼‰ |
| patientName | String | NOT NULL | æ‚£è€…å§“åï¼ˆå†—ä½™å­—æ®µï¼‰ |
| doctorCode | String | NOT NULL | æ¥æ”¶åŒ»ç”Ÿå·¥å·ï¼ˆå¤–é”®ï¼‰ |
| feedbackType | String | NOT NULL | åé¦ˆç±»å‹ï¼ˆpain/question/progress/otherï¼‰ |
| priority | String | DEFAULT "normal" | ä¼˜å…ˆçº§ï¼ˆnormal/urgentï¼‰ |
| content | String | NOT NULL | åé¦ˆå†…å®¹ |
| relatedTaskId | Long | NULLABLE | å…³è”ä»»åŠ¡IDï¼ˆå¯é€‰ï¼‰ |
| status | String | DEFAULT "unread" | çŠ¶æ€ï¼ˆunread/read/repliedï¼‰ |
| replyContent | String | NULLABLE | åŒ»ç”Ÿå›å¤å†…å®¹ |
| repliedAt | Long | NULLABLE | å›å¤æ—¶é—´æˆ³ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: feedbackId
- INDEX: doctorCode, statusï¼ˆç”¨äºæŸ¥è¯¢åŒ»ç”Ÿçš„æœªè¯»åé¦ˆï¼‰
- INDEX: patientIdï¼ˆç”¨äºæŸ¥è¯¢æ‚£è€…çš„åé¦ˆå†å²ï¼‰
- INDEX: priorityï¼ˆç”¨äºä¼˜å…ˆçº§æ’åºï¼‰

**è¯´æ˜**ï¼š
- è¿™æ˜¯æ‚£è€…ä¸»åŠ¨å‘é€çš„ç‹¬ç«‹åé¦ˆï¼Œä¸å…³è”è§†é¢‘
- `feedbackType` ç±»å‹ï¼š
  - painï¼šç–¼ç—›åé¦ˆï¼ˆè‡ªåŠ¨æ ‡è®°ä¸º urgentï¼‰
  - questionï¼šç–‘é—®
  - progressï¼šè¿›åº¦æ±‡æŠ¥
  - otherï¼šå…¶ä»–
- `status` çŠ¶æ€æµè½¬ï¼šunreadï¼ˆæœªè¯»ï¼‰â†’ readï¼ˆå·²è¯»ï¼‰â†’ repliedï¼ˆå·²å›å¤ï¼‰

---

### äº”ã€ä»»åŠ¡æ¨¡å—

#### 10. DoctorTaskï¼ˆåŒ»ç”Ÿä»»åŠ¡è¡¨ï¼‰

**è¡¨å**ï¼š`doctor_task`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| taskId | Long | PRIMARY KEY, AUTO_INCREMENT | ä»»åŠ¡ID |
| doctorCode | String | NOT NULL | åŒ»ç”Ÿå·¥å·ï¼ˆå¤–é”®ï¼‰ |
| taskType | String | NOT NULL | ä»»åŠ¡ç±»å‹ï¼ˆreview_video/reply_feedback/follow_up/make_planï¼‰ |
| patientId | String | NOT NULL | å…³è”æ‚£è€…ID |
| patientName | String | NOT NULL | æ‚£è€…å§“åï¼ˆå†—ä½™å­—æ®µï¼‰ |
| title | String | NOT NULL | ä»»åŠ¡æ ‡é¢˜ |
| description | String | NOT NULL | ä»»åŠ¡æè¿° |
| priority | String | DEFAULT "normal" | ä¼˜å…ˆçº§ï¼ˆnormal/urgentï¼‰ |
| scheduledTime | String | NULLABLE | è®¡åˆ’æ—¶é—´ï¼ˆHH:mmï¼‰ |
| status | String | DEFAULT "pending" | çŠ¶æ€ï¼ˆpending/in_progress/completedï¼‰ |
| relatedId | Long | NULLABLE | å…³è”IDï¼ˆè§†é¢‘IDã€åé¦ˆIDç­‰ï¼‰ |
| completedAt | Long | NULLABLE | å®Œæˆæ—¶é—´æˆ³ |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: taskId
- INDEX: doctorCode, statusï¼ˆç”¨äºæŸ¥è¯¢åŒ»ç”Ÿçš„å¾…åŠä»»åŠ¡ï¼‰
- INDEX: priorityï¼ˆç”¨äºä¼˜å…ˆçº§æ’åºï¼‰

**è¯´æ˜**ï¼š
- åŒ»ç”Ÿçš„æ¯æ—¥ä»»åŠ¡ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨åˆ›å»º
- `taskType` ç±»å‹ï¼š
  - review_videoï¼šå®¡æ ¸è§†é¢‘
  - reply_feedbackï¼šå›å¤åé¦ˆ
  - follow_upï¼šéšè®¿æ‚£è€…
  - make_planï¼šåˆ¶å®šè®¡åˆ’

---

### å…­ã€ç¤¾åŒºæ¨¡å—

#### 11. Postï¼ˆå¸–å­è¡¨ï¼‰

**è¡¨å**ï¼š`post`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| postId | Long | PRIMARY KEY, AUTO_INCREMENT | å¸–å­ID |
| authorId | String | NOT NULL | ä½œè€…IDï¼ˆæ‚£è€…IDï¼‰ |
| authorName | String | NOT NULL | ä½œè€…æ˜¾ç¤ºåç§°ï¼ˆæ˜µç§°æˆ–åŒ¿åï¼‰ |
| isAnonymous | Boolean | DEFAULT false | æ˜¯å¦åŒ¿å |
| title | String | NULLABLE | æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰ |
| content | String | NOT NULL | å†…å®¹ |
| likeCount | Int | DEFAULT 0 | ç‚¹èµæ•° |
| commentCount | Int | DEFAULT 0 | è¯„è®ºæ•° |
| createdAt | Long | NOT NULL | å‘å¸ƒæ—¶é—´æˆ³ |
| updatedAt | Long | NOT NULL | æ›´æ–°æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: postId
- INDEX: authorIdï¼ˆç”¨äºæŸ¥è¯¢ç”¨æˆ·çš„å¸–å­ï¼‰
- INDEX: createdAtï¼ˆç”¨äºæŒ‰æ—¶é—´æ’åºï¼‰
- INDEX: likeCountï¼ˆç”¨äºæŒ‰çƒ­åº¦æ’åºï¼‰

**è¯´æ˜**ï¼š
- `authorName` æ ¹æ® `isAnonymous` å†³å®šæ˜¾ç¤ºæ˜µç§°è¿˜æ˜¯åŒ¿åID

---

#### 12. Commentï¼ˆè¯„è®ºè¡¨ï¼‰

**è¡¨å**ï¼š`comment`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| commentId | Long | PRIMARY KEY, AUTO_INCREMENT | è¯„è®ºID |
| postId | Long | NOT NULL | å¸–å­IDï¼ˆå¤–é”®ï¼‰ |
| authorId | String | NOT NULL | ä½œè€…IDï¼ˆæ‚£è€…IDï¼‰ |
| authorName | String | NOT NULL | ä½œè€…æ˜¾ç¤ºåç§° |
| isAnonymous | Boolean | DEFAULT false | æ˜¯å¦åŒ¿å |
| content | String | NOT NULL | è¯„è®ºå†…å®¹ |
| parentCommentId | Long | NULLABLE | çˆ¶è¯„è®ºIDï¼ˆç”¨äºå›å¤è¯„è®ºï¼‰ |
| createdAt | Long | NOT NULL | å‘å¸ƒæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: commentId
- INDEX: postIdï¼ˆç”¨äºæŸ¥è¯¢å¸–å­çš„è¯„è®ºï¼‰
- INDEX: parentCommentIdï¼ˆç”¨äºæŸ¥è¯¢è¯„è®ºçš„å›å¤ï¼‰

---

#### 13. Likeï¼ˆç‚¹èµè®°å½•è¡¨ï¼‰

**è¡¨å**ï¼š`like_record`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| likeId | Long | PRIMARY KEY, AUTO_INCREMENT | ç‚¹èµID |
| userId | String | NOT NULL | ç”¨æˆ·IDï¼ˆæ‚£è€…IDï¼‰ |
| postId | Long | NOT NULL | å¸–å­IDï¼ˆå¤–é”®ï¼‰ |
| createdAt | Long | NOT NULL | ç‚¹èµæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: likeId
- UNIQUE INDEX: userId, postIdï¼ˆé˜²æ­¢é‡å¤ç‚¹èµï¼‰
- INDEX: postIdï¼ˆç”¨äºç»Ÿè®¡å¸–å­ç‚¹èµæ•°ï¼‰

---

#### 14. Leaderboardï¼ˆæ’è¡Œæ¦œè¡¨ï¼‰

**è¡¨å**ï¼š`leaderboard`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| rankId | Long | PRIMARY KEY, AUTO_INCREMENT | æ’åID |
| weekNumber | String | NOT NULL | å‘¨æ•°ï¼ˆå¦‚"2024-W03"ï¼‰ |
| patientId | String | NOT NULL | æ‚£è€…ID |
| patientName | String | NOT NULL | æ‚£è€…æ˜¾ç¤ºåç§°ï¼ˆæ˜µç§°ï¼‰ |
| completionRate | Float | NOT NULL | å®Œæˆç‡ï¼ˆ0-100ï¼‰ |
| completedTasks | Int | NOT NULL | å®Œæˆä»»åŠ¡æ•° |
| rank | Int | NOT NULL | æ’å |
| createdAt | Long | NOT NULL | åˆ›å»ºæ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: rankId
- UNIQUE INDEX: weekNumber, patientId
- INDEX: weekNumber, rankï¼ˆç”¨äºæŸ¥è¯¢æŸå‘¨çš„æ’è¡Œæ¦œï¼‰

**è¯´æ˜**ï¼š
- æ¯å‘¨ä¸€å‡Œæ™¨è‡ªåŠ¨è®¡ç®—å¹¶ç”Ÿæˆ
- åªåŒ…å«é€‰æ‹©å‚ä¸æ’è¡Œæ¦œçš„æ‚£è€…ï¼ˆPatient.joinRanking = trueï¼‰

---

### ä¸ƒã€èŠå¤©æ¨¡å—

#### 15. ChatMessageï¼ˆèŠå¤©æ¶ˆæ¯è¡¨ï¼‰

**è¡¨å**ï¼š`chat_message`

**å­—æ®µè®¾è®¡**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| messageId | Long | PRIMARY KEY, AUTO_INCREMENT | æ¶ˆæ¯ID |
| patientId | String | NOT NULL | æ‚£è€…ID |
| messageType | String | NOT NULL | æ¶ˆæ¯ç±»å‹ï¼ˆuser/aiï¼‰ |
| content | String | NOT NULL | æ¶ˆæ¯å†…å®¹ |
| createdAt | Long | NOT NULL | å‘é€æ—¶é—´æˆ³ |

**ç´¢å¼•**ï¼š
- PRIMARY KEY: messageId
- INDEX: patientIdï¼ˆç”¨äºæŸ¥è¯¢æ‚£è€…çš„èŠå¤©è®°å½•ï¼‰

**è¯´æ˜**ï¼š
- ç”¨äºå¿ƒç†åŠ©æ‰‹çš„èŠå¤©è®°å½•
- `messageType`ï¼šuserï¼ˆç”¨æˆ·æ¶ˆæ¯ï¼‰/ aiï¼ˆAIå›å¤ï¼‰

---

## ğŸ”— æ•°æ®è¡¨å…³ç³»å›¾

```
Doctor (1) ----< (N) Patient
   |                    |
   |                    +----< (N) RehabPlan
   |                    |           |
   |                    |           +----< (N) TrainingTask
   |                    |                       |
   |                    |                       +----< (N) TaskInstance
   |                    |                                   |
   |                    +----< (N) TrainingVideo -----------+
   |                    |
   |                    +----< (N) PatientFeedback
   |                    |
   +----< (N) DoctorTask                    +----< (N) Post
                                            |           |
Patient (1) ----< (N) ChatMessage           |           +----< (N) Comment
                                            |           |
                                            |           +----< (N) Like
                                            |
                                            +----< (N) Leaderboard

DemoVideoï¼ˆç‹¬ç«‹è¡¨ï¼Œä¾›æ‰€æœ‰æ‚£è€…æµè§ˆï¼‰
```

---

## ğŸ“ˆ æ•°æ®å†—ä½™ç­–ç•¥

ä¸ºäº†æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œåœ¨ä»¥ä¸‹è¡¨ä¸­ä½¿ç”¨å†—ä½™å­—æ®µï¼š

### Doctor è¡¨
- `patientCount`ï¼šé¿å…æ¯æ¬¡éƒ½ COUNT æ‚£è€…æ•°é‡

### Patient è¡¨
- `rehabDays`ï¼šé¿å…æ¯æ¬¡éƒ½è®¡ç®—æ—¥æœŸå·®
- `weeklyCompletionRate`ï¼šé¿å…æ¯æ¬¡éƒ½ç»Ÿè®¡æœ¬å‘¨ä»»åŠ¡
- `todayTasksCompleted`ã€`todayTasksTotal`ï¼šé¿å…æ¯æ¬¡éƒ½ç»Ÿè®¡ä»Šæ—¥ä»»åŠ¡
- `doctorName`ï¼šé¿å…æ¯æ¬¡éƒ½ JOIN Doctor è¡¨

### PatientFeedback è¡¨
- `patientName`ï¼šé¿å…æ¯æ¬¡éƒ½ JOIN Patient è¡¨

### DoctorTask è¡¨
- `patientName`ï¼šé¿å…æ¯æ¬¡éƒ½ JOIN Patient è¡¨

### Post è¡¨
- `likeCount`ã€`commentCount`ï¼šé¿å…æ¯æ¬¡éƒ½ COUNT

**æ›´æ–°ç­–ç•¥**ï¼š
- å†—ä½™å­—æ®µåœ¨ç›¸å…³æ“ä½œæ—¶åŒæ­¥æ›´æ–°
- ä¾‹å¦‚ï¼šæ‚£è€…å®Œæˆä»»åŠ¡æ—¶ï¼Œæ›´æ–° `todayTasksCompleted`
- ä¾‹å¦‚ï¼šå¸–å­è¢«ç‚¹èµæ—¶ï¼Œæ›´æ–° `likeCount`

---

## ğŸš€ ç´¢å¼•ä¼˜åŒ–

### å¤åˆç´¢å¼•
ä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºå¤åˆç´¢å¼•ï¼š

```sql
-- æŸ¥è¯¢åŒ»ç”Ÿçš„å¾…å®¡æ ¸è§†é¢‘
CREATE INDEX idx_video_doctor_status ON training_video(reviewedBy, status);

-- æŸ¥è¯¢æ‚£è€…æŸå¤©çš„ä»»åŠ¡
CREATE INDEX idx_instance_patient_date ON task_instance(patientId, scheduledDate);

-- æŸ¥è¯¢åŒ»ç”Ÿçš„æœªè¯»åé¦ˆ
CREATE INDEX idx_feedback_doctor_status ON patient_feedback(doctorCode, status);

-- æŸ¥è¯¢æŸå‘¨çš„æ’è¡Œæ¦œ
CREATE INDEX idx_leaderboard_week_rank ON leaderboard(weekNumber, rank);
```

---

## ğŸ”„ æ•°æ®åº“è¿ç§»

### ä»ç‰ˆæœ¬4è¿ç§»åˆ°ç‰ˆæœ¬5

**è¿ç§»æ­¥éª¤**ï¼š

1. **åˆ›å»ºæ–°è¡¨**ï¼š
   - task_instance
   - plan_adjustment
   - patient_feedback
   - doctor_task
   - post
   - comment
   - like_record
   - leaderboard
   - chat_message

2. **ä¿®æ”¹ç°æœ‰è¡¨**ï¼š
   - Doctor è¡¨ï¼šæ·»åŠ  titleã€hospitalã€licenseNumberã€phoneã€emailã€monthlyCompletedPlansã€satisfactionRate
   - Patient è¡¨ï¼šæ·»åŠ  nicknameã€rehabDaysã€weeklyCompletionRateã€todayTasksCompletedã€todayTasksTotalã€rehabCenterã€rehabStartDateã€bindingStatusã€joinRanking
   - é‡å‘½å PtRehabVideo ä¸º TrainingVideoï¼Œè°ƒæ•´å­—æ®µ

3. **åˆ›å»ºç´¢å¼•**ï¼š
   - ä¸ºæ‰€æœ‰æ–°è¡¨åˆ›å»ºå¿…è¦çš„ç´¢å¼•
   - ä¸ºç°æœ‰è¡¨çš„æ–°å­—æ®µåˆ›å»ºç´¢å¼•

4. **æ•°æ®è¿ç§»**ï¼š
   - å°†ç°æœ‰æ•°æ®è¿ç§»åˆ°æ–°ç»“æ„
   - è®¡ç®—å¹¶å¡«å……å†—ä½™å­—æ®µçš„åˆå§‹å€¼

---

**æ–‡æ¡£ç»“æŸ**





